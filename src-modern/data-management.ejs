<% const title = 'Data & Backup'; %>
<% const page = 'data-management'; %>

            <!-- Data Management Container -->
            <div x-data="dataManagementComponent" x-init="init()" class="data-management-layout container-fluid p-4 p-lg-4">

                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h3 mb-0">Data & Backup</h1>
                        <p class="text-muted mb-0">Manage your data exports, imports, and system operations</p>
                    </div>
                </div>

                <!-- Data Export Card -->
                <div class="card mb-4">
                    <div class="card-header bg-body-secondary border-bottom rounded-top py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-download me-2"></i>Data Export
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">Download your data in various formats</p>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button type="button"
                                        class="btn btn-outline-primary w-100 py-3"
                                        @click="exportData('json')">
                                    <i class="bi bi-file-code me-2"></i>
                                    <span>JSON</span>
                                </button>
                                <small class="text-muted d-block mt-2 text-center">Data only</small>
                            </div>
                            <div class="col-md-4">
                                <button type="button"
                                        class="btn btn-outline-success w-100 py-3"
                                        @click="exportData('csv')">
                                    <i class="bi bi-file-spreadsheet me-2"></i>
                                    <span>CSV</span>
                                </button>
                                <small class="text-muted d-block mt-2 text-center">Spreadsheet</small>
                            </div>
                            <div class="col-md-4">
                                <button type="button"
                                        class="btn btn-outline-info w-100 py-3"
                                        @click="exportData('zip')">
                                    <i class="bi bi-file-zip me-2"></i>
                                    <span>Full Backup</span>
                                </button>
                                <small class="text-muted d-block mt-2 text-center">Data + Files</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Import Card -->
                <div class="card mb-4">
                    <div class="card-header bg-body-secondary border-bottom rounded-top py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-upload me-2"></i>Data Import
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">Upload and import your data from CSV, JSON, or ZIP files</p>
                        <div class="input-group">
                            <input type="file"
                                   class="form-control"
                                   id="importFile"
                                   accept=".csv,.json,.zip"
                                   @change="onFileSelected($event)">
                            <button class="btn btn-primary"
                                    type="button"
                                    @click="importData()">
                                <i class="bi bi-upload me-2"></i>Import
                            </button>
                        </div>
                        <small class="text-muted d-block mt-2">Supported formats: CSV, JSON, ZIP (Full Backup)</small>
                    </div>
                </div>

                <!-- Danger Zone Card -->
                <div class="card border-danger">
                    <div class="card-header bg-danger bg-opacity-10 border-danger">
                        <h5 class="mb-0 text-danger">
                            <i class="bi bi-exclamation-triangle me-2"></i>Danger Zone
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-4">
                            <strong>Warning:</strong> The following action is irreversible. Please proceed with caution.
                        </p>
                        <button type="button"
                                class="btn btn-danger"
                                @click="resetAllData()">
                            <i class="bi bi-trash me-2"></i>Reset All Data
                        </button>
                    </div>
                </div>

                <!-- Reset Confirmation Modal -->
                <div class="modal fade" 
                     id="resetConfirmModal" 
                     tabindex="-1" 
                     aria-labelledby="resetConfirmModalLabel" 
                     aria-hidden="true"
                     :class="{ 'show d-block': showResetModal }"
                     x-show="showResetModal"
                     style="background-color: rgba(0,0,0,0.5);">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-danger">
                            <div class="modal-header bg-danger bg-opacity-10 border-danger">
                                <h5 class="modal-title text-danger" id="resetConfirmModalLabel">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>⚠️ Irreversible Action
                                </h5>
                                <button type="button" 
                                        class="btn-close" 
                                        @click="closeResetModal()"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-warning d-flex align-items-start mb-3">
                                    <i class="bi bi-info-circle-fill me-2 mt-1"></i>
                                    <div>
                                        <strong>Recommended:</strong> Before proceeding, please <a href="#" @click.prevent="exportData('JSON')" class="alert-link">export your data</a> to create a backup. This action cannot be undone.
                                    </div>
                                </div>
                                <p class="mb-3">
                                    You are about to <strong>permanently delete</strong>:
                                </p>
                                <ul class="list-group list-group-flush mb-3">
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-cart-x text-danger me-2"></i>All purchases
                                    </li>
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-shield-x text-danger me-2"></i>All warranties
                                    </li>
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-shop text-danger me-2"></i>All retailers
                                    </li>
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-tag text-danger me-2"></i>All brands
                                    </li>
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-file-earmark-x text-danger me-2"></i>All uploaded files
                                    </li>
                                    <li class="list-group-item d-flex align-items-center">
                                        <i class="bi bi-gear text-danger me-2"></i>All settings
                                    </li>
                                </ul>
                                <div class="alert alert-danger" role="alert">
                                    <i class="bi bi-exclamation-octagon-fill me-2"></i>
                                    <strong>This action cannot be undone.</strong> All data will be permanently erased.
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Type "DELETE" to confirm:</label>
                                    <input type="text"
                                           class="form-control"
                                           x-model="confirmReset"
                                           placeholder="Type DELETE"
                                           @keyup.enter="confirmReset === 'DELETE' && confirmResetData()">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button"
                                        class="btn btn-secondary"
                                        @click="closeResetModal()">
                                    <i class="bi bi-x-lg me-2"></i>Cancel
                                </button>
                                <button type="button"
                                        class="btn btn-danger"
                                        :disabled="confirmReset !== 'DELETE'"
                                        @click="confirmResetData()">
                                    <i class="bi bi-trash me-2"></i>Yes, Erase Everything
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>
</div>