<!-- Purchase Form Content - Shared between Add Purchase modals -->
<!-- Product Details Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Product Details</h6>

    <div class="mb-3">
        <label for="productName" class="form-label">Product Name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="productName" x-model="form.productName" placeholder="e.g., iPhone 15 Pro Max" :disabled="isViewMode || false">
    </div>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="retailer" class="form-label">Retailer <span class="text-danger">*</span></label>
            <select class="form-select" id="retailer" x-model="form.retailer" @change="onRetailerChange()" :disabled="isViewMode || false">
                <option value="">Select a retailer...</option>
                <template x-for="retailer in retailers" :key="retailer.id">
                    <option :value="retailer.name" x-text="retailer.name"></option>
                </template>
            </select>
        </div>
        <div class="col-md-6">
            <label for="brand" class="form-label">Brand <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="brand" x-model="form.brand" :disabled="isBrandRetailer || isViewMode" placeholder="e.g., Apple" :title="isBrandRetailer ? 'Brand is auto-filled from retailer' : ''">
            <small x-show="isBrandRetailer" class="text-info d-block mt-2">Brand is auto-filled from retailer</small>
        </div>
    </div>

    <div class="row g-3 mt-0">
        <div class="col-md-6">
            <label for="modelNumber" class="form-label">Model Number</label>
            <input type="text" class="form-control" id="modelNumber" x-model="form.modelNumber" placeholder="e.g., A2847" :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="serialNumber" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="serialNumber" x-model="form.serialNumber" placeholder="Enter serial number" :disabled="isViewMode || false">
        </div>
    </div>
</div>

<!-- Purchase Details Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Purchase Details</h6>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="purchaseDate" class="form-label">Purchase Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="purchaseDate" x-model="form.purchaseDate" 
                   :max="new Date().toISOString().split('T')[0]" 
                   :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="price" class="form-label">Price <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" id="price" x-model="form.price" placeholder="0.00" step="0.01" :disabled="isViewMode || false">
            </div>
        </div>
    </div>

    <div class="row g-3 mt-0">
        <div class="col-md-6">
            <label for="quantity" class="form-label">Quantity</label>
            <input type="number" class="form-control" id="quantity" x-model="form.quantity" placeholder="1" min="1" :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="link" class="form-label">Product Link</label>
            <input type="url" class="form-control" id="link" x-model="form.link" placeholder="https://example.com/product" :disabled="isViewMode || false">
        </div>
    </div>
</div>

<!-- Warranty & Returns Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Warranty & Returns</h6>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="warrantyExpiry" class="form-label">Warranty Expiry Date</label>
            <input type="date" class="form-control" id="warrantyExpiry" x-model="form.warrantyExpiry" :disabled="isViewMode || false">
            <small class="text-muted">Leave blank if not applicable</small>
        </div>
        <div class="col-md-6">
            <label for="returnDeadline" class="form-label">Return Deadline</label>
            <input type="date" class="form-control" id="returnDeadline" x-model="form.returnDeadline" :disabled="isViewMode || false">
            <small class="text-muted">Leave blank if not applicable</small>
        </div>
    </div>

    <div class="mt-3">
        <label for="returnPolicy" class="form-label">Return Policy</label>
        <textarea class="form-control" id="returnPolicy" x-model="form.returnPolicy" rows="2" placeholder="e.g., 30-day money back guarantee" :disabled="isViewMode || false"></textarea>
    </div>
</div>

<!-- Tax & Tags Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Additional Info</h6>

    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="taxDeductible" x-model="form.taxDeductible" :disabled="isViewMode || false">
        <label class="form-check-label" for="taxDeductible">
            Tax Deductible
        </label>
    </div>

    <div>
        <label for="tags" class="form-label">Tags</label>
        <div class="tag-input-container">
            <input type="text" 
                   class="form-control" 
                   id="tags" 
                   x-model="currentTagInput"
                   @keydown="if ($event.key === 'Enter' || $event.key === ',') { $event.preventDefault(); addTagFromInput(); }"
                   @blur="addTagFromInput()"
                   placeholder="Type a tag and press Enter or comma..." 
                   :disabled="isViewMode || false">
            
            <!-- Display existing tags -->
            <div class="tag-list mt-2" x-show="tagsArray && tagsArray.length > 0">
                <template x-for="tag in tagsArray" :key="tag">
                    <span class="badge bg-primary me-2 mb-2 d-inline-flex align-items-center">
                        <span x-text="tag"></span>
                        <button type="button" 
                                class="btn-close btn-close-white ms-2" 
                                @click="removeTag(tag)"
                                style="font-size: 0.6rem;"
                                aria-label="Remove tag"></button>
                    </span>
                </template>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Notes</h6>
    <textarea class="form-control" x-model="form.notes" rows="3" placeholder="Add any additional notes..." :disabled="isViewMode || false"></textarea>
</div>

<!-- File Upload Section -->
<div class="mb-4" x-show="!isViewMode">
    <div class="border rounded p-3" style="border: 1px solid #dee2e6;">
        <h6 class="text-center text-muted fw-semibold mb-3">Upload Files</h6>

        <!-- Receipts Section -->
        <div class="mb-3">
            <!-- Empty State - Large Upload Area -->
            <template x-if="!hasFilesOfType('receipt')">
                <label for="uploadReceipts" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                    <div class="mb-2">
                        <i class="bi bi-file-earmark-text" style="font-size: 2.5rem; color: #6366f1;"></i>
                    </div>
                    <div class="text-dark fw-semibold">Upload Receipt(s)</div>
                    <small class="text-muted">PDF or images</small>
                    <input type="file" class="form-control d-none" id="uploadReceipts" multiple accept="image/*,.pdf" @change="handleFileUpload($event, 'receipt')">
                </label>
            </template>
            
            <!-- Compact State - Files Exist -->
            <template x-if="hasFilesOfType('receipt')">
                <div class="border rounded p-2" style="background-color: #f8f9ff; border-color: #d0d8f2 !important;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-file-earmark-text me-2" style="color: #6366f1;"></i>
                            <span class="fw-semibold small">Receipts</span>
                            <span class="badge bg-primary ms-2" x-text="getFilesByType('receipt').length"></span>
                        </div>
                        <label for="uploadReceiptsMore" class="btn btn-sm btn-primary py-0 px-2 d-flex align-items-center justify-content-center">
                            <i class="bi bi-plus"></i>
                            <input type="file" class="form-control d-none" id="uploadReceiptsMore" multiple accept="image/*,.pdf" @change="handleFileUpload($event, 'receipt')">
                        </label>
                    </div>
                    <!-- File Thumbnails -->
                    <div class="d-flex gap-2 flex-wrap">
                        <template x-for="file in getFilesByType('receipt')" :key="file.id">
                            <div class="position-relative" style="cursor: pointer;" @click="openFileViewer(file)">
                                <!-- Image Preview -->
                                <template x-if="isImageFile(file)">
                                    <img :src="getFilePreviewUrl(file)" class="rounded" style="width: 60px; height: 60px; object-fit: cover; border: 1px solid #dee2e6;">
                                </template>
                                <!-- PDF Icon -->
                                <template x-if="!isImageFile(file)">
                                    <div class="d-flex align-items-center justify-content-center rounded position-relative" style="width: 60px; height: 60px; background-color: #f8d7da; border: 1px solid #dee2e6;">
                                        <i class="bi bi-file-earmark-pdf text-danger" style="font-size: 1.5rem;"></i>
                                    </div>
                                </template>
                                <!-- Delete Button -->
                                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 p-0" style="width: 18px; height: 18px; font-size: 10px; line-height: 1; transform: translate(30%, -30%);" @click.stop="removeAnyFile(file)">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- Manuals Section -->
        <div class="mb-3">
            <template x-if="!hasFilesOfType('manual')">
                <label for="uploadManuals" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                    <div class="mb-2">
                        <i class="bi bi-book" style="font-size: 2.5rem; color: #6366f1;"></i>
                    </div>
                    <div class="text-dark fw-semibold">Upload Manual(s)</div>
                    <small class="text-muted">PDF, DOC, DOCX</small>
                    <input type="file" class="form-control d-none" id="uploadManuals" multiple accept=".pdf,.doc,.docx" @change="handleFileUpload($event, 'manual')">
                </label>
            </template>
            
            <template x-if="hasFilesOfType('manual')">
                <div class="border rounded p-2" style="background-color: #f8f9ff; border-color: #d0d8f2 !important;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-book me-2" style="color: #6366f1;"></i>
                            <span class="fw-semibold small">Manuals</span>
                            <span class="badge bg-primary ms-2" x-text="getFilesByType('manual').length"></span>
                        </div>
                        <label for="uploadManualsMore" class="btn btn-sm btn-primary py-0 px-2 d-flex align-items-center justify-content-center">
                            <i class="bi bi-plus"></i>
                            <input type="file" class="form-control d-none" id="uploadManualsMore" multiple accept=".pdf,.doc,.docx" @change="handleFileUpload($event, 'manual')">
                        </label>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <template x-for="file in getFilesByType('manual')" :key="file.id">
                            <div class="position-relative" style="cursor: pointer;" @click="openFileViewer(file)">
                                <template x-if="isImageFile(file)">
                                    <img :src="getFilePreviewUrl(file)" class="rounded" style="width: 60px; height: 60px; object-fit: cover; border: 1px solid #dee2e6;">
                                </template>
                                <template x-if="!isImageFile(file)">
                                    <div class="d-flex align-items-center justify-content-center rounded position-relative" :style="`width: 60px; height: 60px; background-color: ${getFileColor(file)}; border: 1px solid #dee2e6;`">
                                        <i :class="getFileIcon(file)" style="font-size: 1.5rem;"></i>
                                    </div>
                                </template>
                                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 p-0" style="width: 18px; height: 18px; font-size: 10px; line-height: 1; transform: translate(30%, -30%);" @click.stop="removeAnyFile(file)">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- Photos Section -->
        <div class="mb-3">
            <template x-if="!hasFilesOfType('photo')">
                <label for="uploadPhotos" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                    <div class="mb-2">
                        <i class="bi bi-camera" style="font-size: 2.5rem; color: #6366f1;"></i>
                    </div>
                    <div class="text-dark fw-semibold">Upload Photo(s)</div>
                    <small class="text-muted">Images only</small>
                    <input type="file" class="form-control d-none" id="uploadPhotos" multiple accept="image/*" @change="handleFileUpload($event, 'photo')">
                </label>
            </template>
            
            <template x-if="hasFilesOfType('photo')">
                <div class="border rounded p-2" style="background-color: #f8f9ff; border-color: #d0d8f2 !important;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-camera me-2" style="color: #6366f1;"></i>
                            <span class="fw-semibold small">Photos</span>
                            <span class="badge bg-primary ms-2" x-text="getFilesByType('photo').length"></span>
                        </div>
                        <label for="uploadPhotosMore" class="btn btn-sm btn-primary py-0 px-2 d-flex align-items-center justify-content-center">
                            <i class="bi bi-plus"></i>
                            <input type="file" class="form-control d-none" id="uploadPhotosMore" multiple accept="image/*" @change="handleFileUpload($event, 'photo')">
                        </label>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <template x-for="file in getFilesByType('photo')" :key="file.id">
                            <div class="position-relative" style="cursor: pointer;" @click="openFileViewer(file)">
                                <img :src="getFilePreviewUrl(file)" class="rounded" style="width: 60px; height: 60px; object-fit: cover; border: 1px solid #dee2e6;">
                                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 p-0" style="width: 18px; height: 18px; font-size: 10px; line-height: 1; transform: translate(30%, -30%);" @click.stop="removeAnyFile(file)">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- Warranty Documents Section -->
        <div>
            <template x-if="!hasFilesOfType('warranty')">
                <label for="uploadWarranty" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                    <div class="mb-2">
                        <i class="bi bi-shield-check" style="font-size: 2.5rem; color: #6366f1;"></i>
                    </div>
                    <div class="text-dark fw-semibold">Upload Warranty Doc(s)</div>
                    <small class="text-muted">PDF or images</small>
                    <input type="file" class="form-control d-none" id="uploadWarranty" multiple accept=".pdf,.doc,.docx,image/*" @change="handleFileUpload($event, 'warranty')">
                </label>
            </template>
            
            <template x-if="hasFilesOfType('warranty')">
                <div class="border rounded p-2" style="background-color: #f8f9ff; border-color: #d0d8f2 !important;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-shield-check me-2" style="color: #6366f1;"></i>
                            <span class="fw-semibold small">Warranty Docs</span>
                            <span class="badge bg-primary ms-2" x-text="getFilesByType('warranty').length"></span>
                        </div>
                        <label for="uploadWarrantyMore" class="btn btn-sm btn-primary py-0 px-2 d-flex align-items-center justify-content-center">
                            <i class="bi bi-plus"></i>
                            <input type="file" class="form-control d-none" id="uploadWarrantyMore" multiple accept=".pdf,.doc,.docx,image/*" @change="handleFileUpload($event, 'warranty')">
                        </label>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <template x-for="file in getFilesByType('warranty')" :key="file.id">
                            <div class="position-relative" style="cursor: pointer;" @click="openFileViewer(file)">
                                <template x-if="isImageFile(file)">
                                    <img :src="getFilePreviewUrl(file)" class="rounded" style="width: 60px; height: 60px; object-fit: cover; border: 1px solid #dee2e6;">
                                </template>
                                <template x-if="!isImageFile(file)">
                                    <div class="d-flex align-items-center justify-content-center rounded position-relative" :style="`width: 60px; height: 60px; background-color: ${getFileColor(file)}; border: 1px solid #dee2e6;`">
                                        <i :class="getFileIcon(file)" style="font-size: 1.5rem;"></i>
                                    </div>
                                </template>
                                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 p-0" style="width: 18px; height: 18px; font-size: 10px; line-height: 1; transform: translate(30%, -30%);" @click.stop="removeAnyFile(file)">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- Note: Files open in browser's native viewer (new tab) -->
