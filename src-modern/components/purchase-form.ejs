<!-- Purchase Form Content - Shared between Add Purchase modals -->
<!-- Product Details Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Product Details</h6>

    <div class="mb-3">
        <label for="productName" class="form-label">Product Name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="productName" x-model="form.productName" placeholder="e.g., iPhone 15 Pro Max" :disabled="isViewMode || false">
    </div>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="retailer" class="form-label">Retailer <span class="text-danger">*</span></label>
            <select class="form-select" id="retailer" x-model="form.retailer" @change="onRetailerChange()" :disabled="isViewMode || false">
                <option value="">Select a retailer...</option>
                <template x-for="retailer in retailers" :key="retailer.id">
                    <option :value="retailer.name" x-text="retailer.name"></option>
                </template>
            </select>
        </div>
        <div class="col-md-6">
            <label for="brand" class="form-label">Brand <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="brand" x-model="form.brand" :disabled="isBrandRetailer || isViewMode" placeholder="e.g., Apple" :title="isBrandRetailer ? 'Brand is auto-filled from retailer' : ''">
            <small x-show="isBrandRetailer" class="text-info d-block mt-2">Brand is auto-filled from retailer</small>
        </div>
    </div>

    <div class="row g-3 mt-0">
        <div class="col-md-6">
            <label for="modelNumber" class="form-label">Model Number</label>
            <input type="text" class="form-control" id="modelNumber" x-model="form.modelNumber" placeholder="e.g., A2847" :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="serialNumber" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="serialNumber" x-model="form.serialNumber" placeholder="Enter serial number" :disabled="isViewMode || false">
        </div>
    </div>
</div>

<!-- Purchase Details Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Purchase Details</h6>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="purchaseDate" class="form-label">Purchase Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="purchaseDate" x-model="form.purchaseDate" :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="price" class="form-label">Price <span class="text-danger">*</span></label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" id="price" x-model="form.price" placeholder="0.00" step="0.01" :disabled="isViewMode || false">
            </div>
        </div>
    </div>

    <div class="row g-3 mt-0">
        <div class="col-md-6">
            <label for="quantity" class="form-label">Quantity</label>
            <input type="number" class="form-control" id="quantity" x-model="form.quantity" placeholder="1" min="1" :disabled="isViewMode || false">
        </div>
        <div class="col-md-6">
            <label for="link" class="form-label">Product Link</label>
            <input type="url" class="form-control" id="link" x-model="form.link" placeholder="https://example.com/product" :disabled="isViewMode || false">
        </div>
    </div>
</div>

<!-- Warranty & Returns Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Warranty & Returns</h6>

    <div class="row g-3">
        <div class="col-md-6">
            <label for="warrantyExpiry" class="form-label">Warranty Expiry Date</label>
            <input type="date" class="form-control" id="warrantyExpiry" x-model="form.warrantyExpiry" :disabled="isViewMode || false">
            <small class="text-muted">Leave blank if not applicable</small>
        </div>
        <div class="col-md-6">
            <label for="returnDeadline" class="form-label">Return Deadline</label>
            <input type="date" class="form-control" id="returnDeadline" x-model="form.returnDeadline" :disabled="isViewMode || false">
            <small class="text-muted">Leave blank if not applicable</small>
        </div>
    </div>

    <div class="mt-3">
        <label for="returnPolicy" class="form-label">Return Policy</label>
        <textarea class="form-control" id="returnPolicy" x-model="form.returnPolicy" rows="2" placeholder="e.g., 30-day money back guarantee" :disabled="isViewMode || false"></textarea>
    </div>
</div>

<!-- Tax & Tags Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Additional Info</h6>

    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="taxDeductible" x-model="form.taxDeductible" :disabled="isViewMode || false">
        <label class="form-check-label" for="taxDeductible">
            Tax Deductible
        </label>
    </div>

    <div>
        <label for="tags" class="form-label">Tags</label>
        <input type="text" class="form-control" id="tags" x-model="form.tags" placeholder="e.g., electronics, work, home" :disabled="isViewMode || false">
    </div>
</div>

<!-- Notes Section -->
<div class="mb-4">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Notes</h6>
    <textarea class="form-control" x-model="form.notes" rows="3" placeholder="Add any additional notes..." :disabled="isViewMode || false"></textarea>
</div>

<!-- File Upload Section -->
<div class="mb-4" x-show="!isViewMode">
    <div class="border rounded p-4" style="border: 1px solid #dee2e6;">
        <h6 class="text-center text-muted fw-semibold mb-4">Upload Files</h6>

        <!-- Upload Receipts -->
        <div class="mb-3">
            <label for="uploadReceipts" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                <div class="mb-2">
                    <i class="bi bi-file-earmark-text" style="font-size: 2.5rem; color: #6366f1;"></i>
                </div>
                <div class="text-dark fw-semibold">Upload Receipt(s)</div>
                <input type="file" class="form-control d-none" id="uploadReceipts" multiple accept="image/*,.pdf" @change="handleFileUpload($event, 'receipt')">
            </label>
        </div>

        <!-- Upload Manuals -->
        <div class="mb-3">
            <label for="uploadManuals" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                <div class="mb-2">
                    <i class="bi bi-book" style="font-size: 2.5rem; color: #6366f1;"></i>
                </div>
                <div class="text-dark fw-semibold">Upload Manual(s)</div>
                <input type="file" class="form-control d-none" id="uploadManuals" multiple accept=".pdf,.doc,.docx" @change="handleFileUpload($event, 'manual')">
            </label>
        </div>

        <!-- Upload Photos -->
        <div class="mb-3">
            <label for="uploadPhotos" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                <div class="mb-2">
                    <i class="bi bi-camera" style="font-size: 2.5rem; color: #6366f1;"></i>
                </div>
                <div class="text-dark fw-semibold">Upload Photo(s)</div>
                <input type="file" class="form-control d-none" id="uploadPhotos" multiple accept="image/*" @change="handleFileUpload($event, 'photo')">
            </label>
        </div>

        <!-- Upload Warranty Documents -->
        <div>
            <label for="uploadWarranty" class="d-block text-center p-4 rounded" style="background-color: #f0f4ff; border: 2px dashed #d0d8f2; cursor: pointer; transition: all 0.3s;">
                <div class="mb-2">
                    <i class="bi bi-shield-check" style="font-size: 2.5rem; color: #6366f1;"></i>
                </div>
                <div class="text-dark fw-semibold">Upload Warranty Document(s)</div>
                <input type="file" class="form-control d-none" id="uploadWarranty" multiple accept=".pdf,.doc,.docx,image/*" @change="handleFileUpload($event, 'warranty')">
            </label>
        </div>
    </div>
</div>

<!-- Temporary Files Preview (for files added before saving purchase) -->
<div class="mb-4" x-show="tempFiles && tempFiles.length > 0">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Pending Files</h6>
    <div class="row g-3">
        <template x-for="file in tempFiles" :key="file.id">
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="card-title mb-1" x-text="file.fileName"></h6>
                                <small class="text-muted" x-text="file.fileType.toUpperCase()"></small>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" @click="removeTempFile(file.id)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        <small class="text-muted" x-text="formatFileSize(file.fileSize)"></small>
                        <!-- Preview for images -->
                        <div x-show="file.mimeType.startsWith('image/')">
                            <img :src="file.previewUrl" class="img-thumbnail mt-2" style="max-height: 100px;" alt="Preview">
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>

<!-- Uploaded Files Preview (for edit mode) -->
<div class="mb-4" x-show="editingItemId && uploadedFiles.length > 0">
    <h6 class="text-muted text-uppercase small fw-semibold mb-3">Uploaded Files</h6>
    <div class="row g-3">
        <template x-for="file in uploadedFiles" :key="file.id">
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="card-title mb-1" x-text="file.filename"></h6>
                                <small class="text-muted" x-text="file.file_type.toUpperCase()"></small>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" @click="removeFile(file.id)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        <small class="text-muted" x-text="formatFileSize(file.file_size)"></small>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>
