import{T as D,M as w,D as it,O as rt,C as nt,a as ot,b as ct,P as lt}from"./vendor-bootstrap-C9iorZI5.js";import{C as f,a as dt,L as ht,P as ut,b as pt,c as mt,D as gt,p as ft,d as bt,e as wt,A as yt,i as vt}from"./vendor-charts-TarMSkGa.js";import{S as m,m as g}from"./vendor-ui-CflGdlft.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();class St{constructor(){this.currentTheme=this.getStoredTheme()||this.getPreferredTheme(),this.themeToggleButtons=[],this.init()}init(){this.setTheme(this.currentTheme),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.getStoredTheme()||this.setTheme(t.matches?"dark":"light")})}getStoredTheme(){return localStorage.getItem("theme")}getPreferredTheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}setTheme(t){document.documentElement.setAttribute("data-bs-theme",t),localStorage.setItem("theme",t),this.currentTheme=t,this.updateThemeIcons()}toggleTheme(){const t=this.currentTheme==="light"?"dark":"light";this.setTheme(t)}updateThemeIcons(){const t=document.querySelectorAll(".theme-icon-light"),e=document.querySelectorAll(".theme-icon-dark");this.currentTheme==="dark"?(t.forEach(s=>s.classList.add("d-none")),e.forEach(s=>s.classList.remove("d-none"))):(t.forEach(s=>s.classList.remove("d-none")),e.forEach(s=>s.classList.add("d-none")))}getCurrentTheme(){return this.currentTheme}}f.register(dt,ht,ut,pt,mt,gt,ft,bt,wt,yt,vt);class Et{constructor(){this.charts=new Map,this.data={warranty:[],spending:[],retailers:[],brands:[],topProducts:[],orders:[],recentOrders:[]},this.init()}async init(){console.log("ðŸ“Š Dashboard initialized"),await this.loadDashboardData(),this.initWarrantyCharts(),this.initSpendingCharts(),this.initOrderStatusCharts(),this.populateTopProducts(),this.populateRecentOrders()}async loadDashboardData(){try{const t=document.querySelector('button[title="Refresh data"] i');t&&t.classList.add("icon-spin"),this.showLoadingState();const[e,s,a,r,n,o,c]=await Promise.all([this.fetchWarrantyData(),this.fetchSpendingData(),this.fetchRetailersData(),this.fetchBrandsData(),this.fetchTopProductsData(),this.fetchRecentOrdersData(),this.fetchSummaryData()]);this.updateKPICards(c),this.data.warranty=e,this.data.spending=s,this.data.retailers=a,this.data.brands=r,this.data.topProducts=n,this.data.recentOrders=o,this.data.orders=this.calculateOrderData(o),this.updateCharts(),this.populateTopProducts(),this.populateRecentOrders(),this.hideLoadingState()}catch(t){console.error("Error loading dashboard data:",t),this.showErrorState()}finally{const t=document.querySelector('button[title="Refresh data"] i');t&&t.classList.remove("icon-spin")}}updateCharts(){this.charts.forEach((t,e)=>{e.startsWith("warranty-")?(t.data.labels=this.data.warranty.map(s=>s.month),t.data.datasets[0].data=this.data.warranty.map(s=>s.active),t.data.datasets[1].data=this.data.warranty.map(s=>s.expired),t.data.datasets[2]&&(t.data.datasets[2].data=this.data.warranty.map(s=>s.expiring_soon)),t.update("none")):e==="spending"?(t.data.labels=this.data.spending.map(s=>s.month),t.data.datasets[0].data=this.data.spending.map(s=>s.totalSpending),t.data.datasets[1].data=this.data.spending.map(s=>s.itemsCount),t.update("none")):e==="retailers"?(t.data.labels=this.data.retailers.map(s=>s.name),t.data.datasets[0].data=this.data.retailers.map(s=>Math.round(s.percentage)),t.update("none")):e==="brands"&&(t.data.labels=this.data.brands.map(s=>s.name),t.data.datasets[0].data=this.data.brands.map(s=>Math.round(s.percentage)),t.update("none"))})}async fetchWarrantyData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/warranties/timeline`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).timeline||[]}catch(t){return console.error("Error fetching warranty data:",t),this.generateWarrantyData()}}async fetchSpendingData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/spending`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return((await e.json()).spending_over_time||[]).map(a=>({month:a.month,totalSpending:parseFloat(a.total_amount),itemsCount:a.item_count}))}catch(t){return console.error("Error fetching spending data:",t),this.generateSpendingData()}}async fetchRetailersData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/retailers`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).retailers||[]}catch(t){return console.error("Error fetching retailers data:",t),this.generateRetailerData()}}async fetchBrandsData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/brands`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).brands||[]}catch(t){return console.error("Error fetching brands data:",t),this.generateBrandData()}}async fetchTopProductsData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/top-products`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return((await e.json()).top_products||[]).map((a,r)=>({rank:r+1,name:a.product_name,price:"$"+parseFloat(a.avg_price).toLocaleString(),date:new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}))}catch(t){return console.error("Error fetching top products data:",t),this.generateTopProducts()}}async fetchRecentOrdersData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/recent-purchases?limit=10`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()||[]).map(a=>({id:a.id.substring(0,8)+"...",customer:a.product_name,amount:"$"+parseFloat(a.price).toLocaleString(),status:{class:a.status==="RECEIVED"?"bg-success":"bg-warning",text:a.status},date:new Date(a.purchase_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}))}catch(t){return console.error("Error fetching recent orders data:",t),this.generateRecentOrders()}}async fetchSummaryData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/summary`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){return console.error("Error fetching summary data:",t),null}}updateKPICards(t){if(!t)return;const e=document.querySelector('[data-kpi="total-value"] .kpi-value');e&&t.total_spent!==void 0&&(e.textContent="$"+parseFloat(t.total_spent).toLocaleString());const s=document.querySelector('[data-kpi="items-count"] .kpi-value');s&&t.total_items!==void 0&&(s.textContent=t.total_items.toLocaleString());const a=document.querySelector('[data-kpi="avg-price"] .kpi-value');a&&t.avg_price!==void 0&&(a.textContent="$"+Math.round(parseFloat(t.avg_price)).toLocaleString());const r=document.querySelector('[data-kpi="active-warranties"] .kpi-value');r&&t.active_warranties!==void 0&&(r.textContent=t.active_warranties.toLocaleString());const n=document.querySelector('[data-kpi="tax-deductible"] .kpi-value');n&&t.tax_deductible_count!==void 0&&(n.textContent=t.tax_deductible_count.toLocaleString());const o=document.querySelector('[data-kpi="expired-warranties"] .kpi-value');o&&t.expired_warranties!==void 0&&(o.textContent=t.expired_warranties.toLocaleString())}calculateOrderData(t){const e=t.filter(n=>n.status==="RECEIVED").length,s=t.filter(n=>n.status==="ORDERED").length,a=t.filter(n=>n.status==="PENDING").length,r=t.length-(e+s+a);return{completed:e,processing:s,pending:a,cancelled:r}}showLoadingState(){document.querySelectorAll(".card").forEach(e=>{const s=document.createElement("div");s.className="position-absolute top-50 start-50 translate-middle",s.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',s.style.zIndex="10",e.style.position="relative",e.appendChild(s)})}hideLoadingState(){document.querySelectorAll(".spinner-border").forEach(e=>e.remove())}showErrorState(){const t=document.createElement("div");t.className="alert alert-danger",t.innerHTML="<strong>Error:</strong> Failed to load dashboard data. Please check your connection and try again.";const e=document.querySelector(".container-fluid")||document.body;e.insertBefore(t,e.firstChild),this.data.warranty=this.generateWarrantyData(),this.data.spending=this.generateSpendingData(),this.data.retailers=this.generateRetailerData(),this.data.brands=this.generateBrandData(),this.data.topProducts=this.generateTopProducts(),this.data.orders=this.generateOrderData(),this.data.recentOrders=this.generateRecentOrders()}generateWarrantyData(){const t=new Date(2025,3,1),e=[];for(let s=0;s<12;s++){const a=new Date(t);a.setMonth(a.getMonth()+s);const r=a.toLocaleDateString("en-US",{month:"short",year:"2-digit"});e.push(r)}return e.map(s=>({month:s,active:Math.floor(Math.random()*30)+20,expired:Math.floor(Math.random()*15)+5,expiring_soon:Math.floor(Math.random()*10)+2}))}generateSpendingData(){const t=new Date(2025,3,1),e=[];for(let s=0;s<12;s++){const a=new Date(t);a.setMonth(a.getMonth()+s);const r=a.toLocaleDateString("en-US",{month:"short",year:"2-digit"});e.push(r)}return e.map(s=>({month:s,totalSpending:Math.floor(Math.random()*3e3)+1e3,itemsCount:Math.floor(Math.random()*15)+5}))}generateRetailerData(){return["Amazon","eBay","Walmart","Target","Best Buy"].map(e=>({name:e,count:Math.floor(Math.random()*10)+1,percentage:Math.floor(Math.random()*30)+10}))}generateBrandData(){return["Apple","Sony","Samsung","LG","Dell"].map(e=>({name:e,count:Math.floor(Math.random()*10)+1,percentage:Math.floor(Math.random()*25)+10}))}generateTopProducts(){const t=['MacBook Pro 16"',"iPhone 15 Pro Max","Sony WH-1000XM5 Headphones",'Samsung 55" QLED TV',"iPad Air","Dell XPS 13 Laptop","AirPods Pro",'LG 27" Gaming Monitor',"Apple Watch Series 9","Sony PlayStation 5"],e=()=>{const s=new Date(2021,9,1).getTime(),a=new Date(2026,0,31).getTime(),r=s+Math.random()*(a-s);return new Date(r).toLocaleDateString()};return t.map((s,a)=>({rank:a+1,name:s,price:`$${(Math.random()*2e3+100).toFixed(2)}`,date:e()}))}generateOrderData(){return{completed:1245,processing:156,pending:87,cancelled:23}}generateRecentOrders(){const t=["Bose Speaker","iPhone 15",'MacBook Pro 14"',"IKEA Bookshelf","Wireless Mouse","USB-C Hub","Monitor Stand","Desk Lamp","Mechanical Keyboard","Webcam 4K"],e=[{text:"Ordered",class:"bg-primary"},{text:"Received",class:"bg-success"}],s=()=>{const a=new Date(2021,9,1).getTime(),r=new Date(2026,0,31).getTime(),n=a+Math.random()*(r-a);return new Date(n).toLocaleDateString()};return Array.from({length:10},()=>({id:`#${Math.floor(Math.random()*9e3)+1e3}`,customer:t[Math.floor(Math.random()*t.length)],amount:`$${(Math.random()*500+50).toFixed(2)}`,status:e[Math.floor(Math.random()*e.length)],date:s()}))}initWarrantyCharts(){document.querySelectorAll("canvas#warrantyChart").forEach((e,s)=>{const a=new f(e,{type:"line",data:{labels:this.data.warranty.map(r=>r.month),datasets:[{label:"Active Warranties",data:this.data.warranty.map(r=>r.active),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(16, 185, 129)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8},{label:"Expired Warranties",data:this.data.warranty.map(r=>r.expired),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(239, 68, 68)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8},{label:"Expiring Soon",data:this.data.warranty.map(r=>r.expiring_soon),borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(245, 158, 11)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(r){return`${r.dataset.label}: ${r.parsed.y} warranties`}}}},scales:{x:{grid:{display:!1},border:{display:!1}},y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},border:{display:!1},ticks:{stepSize:1,precision:0,callback:function(r){return Math.round(r)+" warranties"}}}}}});this.charts.set(`warranty-${s}`,a)})}initSpendingCharts(){document.querySelectorAll("canvas#spendingChart").forEach((e,s)=>{const a=new f(e,{type:"line",data:{labels:this.data.spending.map(r=>r.month),datasets:[{label:"Total Spending",data:this.data.spending.map(r=>r.totalSpending),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(59, 130, 246)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,yAxisID:"y"},{label:"Items Purchased",data:this.data.spending.map(r=>r.itemsCount),borderColor:"rgb(20, 184, 166)",backgroundColor:"rgba(20, 184, 166, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(20, 184, 166)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(r){return r.datasetIndex===0?`${r.dataset.label}: $${r.parsed.y.toLocaleString()}`:`${r.dataset.label}: ${r.parsed.y} items`}}}},scales:{x:{grid:{display:!1},border:{display:!1}},y:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},border:{display:!1},ticks:{callback:function(r){return"$"+r.toLocaleString()}},title:{display:!0,text:"Total Spending ($)",color:"rgb(59, 130, 246)"}},y1:{type:"linear",display:!0,position:"right",beginAtZero:!0,grid:{drawOnChartArea:!1},border:{display:!1},ticks:{stepSize:1,precision:0,callback:function(r){return r+" items"}},title:{display:!0,text:"Items Purchased",color:"rgb(20, 184, 166)"}}}}});this.charts.set("spending",a)})}initOrderStatusCharts(){document.querySelectorAll("canvas#orderStatusChart").forEach((e,s)=>{const r=e.closest(".card")?.querySelector(".card-header")?.textContent.includes("Retailers"),n=r?this.data.retailers:this.data.brands,o=n.map(d=>d.name),c=n.map(d=>Math.round(d.percentage)),l=["rgba(16, 185, 129, 0.8)","rgba(99, 102, 241, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],u=new f(e,{type:"doughnut",data:{labels:o,datasets:[{data:c,backgroundColor:l.slice(0,c.length),borderWidth:0,cutout:"60%"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(d){const h=d.label||"",p=Math.round(d.parsed);return`${h}: ${p}%`}}}}}});this.charts.set(r?"retailers":"brands",u)})}populateTopProducts(){const t=document.querySelector("tbody#top-products-table");if(!t)return;const e=this.data.topProducts.map(s=>`
        <tr>
            <td><strong>#${s.rank}</strong></td>
            <td>${s.name}</td>
            <td>${s.price}</td>
            <td>${s.date}</td>
        </tr>
    `).join("");t.innerHTML=e}populateRecentOrders(){const t=document.querySelectorAll("tbody#recent-orders-table"),e=this.data.recentOrders.map(s=>`
        <tr>
            <td><strong>${s.id}</strong></td>
            <td>${s.customer}</td>
            <td>${s.amount}</td>
            <td><span class="badge ${s.status.class}">${s.status.text}</span></td>
            <td>${s.date}</td>
        </tr>
    `).join("");t.forEach(s=>{s.innerHTML=e})}destroy(){this.charts.forEach(t=>t.destroy()),this.charts.clear()}}class Dt{constructor(){this.container=document.getElementById("toast-container")||this.createToastContainer(),this.defaultDuration=5e3,this.activeToasts=new Set,this.init()}init(){this.container||(this.container=this.createToastContainer()),this.configureSweetAlert()}createToastContainer(){const t=document.createElement("div");return t.id="toast-container",t.className="position-fixed top-0 end-0 p-3",t.style.zIndex="9999",t.style.marginTop="70px",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),document.body.appendChild(t),t}configureSweetAlert(){m.mixin({customClass:{confirmButton:"btn btn-primary me-2",cancelButton:"btn btn-secondary",popup:"rounded-3 shadow-lg",title:"fs-4 fw-bold",content:"text-muted"},buttonsStyling:!1,reverseButtons:!0,focusConfirm:!1,allowOutsideClick:!0,allowEscapeKey:!0,showCloseButton:!0})}show(t,e="info",s={}){const a={message:t,type:e,duration:s.duration||this.defaultDuration,persistent:s.persistent||!1,action:s.action||null,icon:s.icon||this.getIconForType(e)},r=this.createToast(a);this.container.appendChild(r);const n=new D(r,{autohide:!a.persistent,delay:a.duration});return this.activeToasts.add(n),r.addEventListener("hidden.bs.toast",()=>{this.activeToasts.delete(n),r.remove()}),n.show(),n}createToast(t){const e=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s=document.createElement("div");s.className=`toast align-items-center text-bg-${t.type} border-0`,s.id=e,s.role="alert",s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true");const a=t.persistent?"":`
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    `,r=t.action?`
      <button type="button" class="btn btn-sm btn-outline-light me-2" onclick="${t.action.handler}">
        ${t.action.text}
      </button>
    `:"";return s.innerHTML=`
      <div class="d-flex">
        <div class="toast-body d-flex align-items-center">
          <i class="${t.icon} me-2"></i>
          <span class="flex-grow-1">${t.message}</span>
          ${r}
        </div>
        ${a}
      </div>
    `,s}getIconForType(t){const e={success:"bi bi-check-circle-fill",error:"bi bi-exclamation-triangle-fill",warning:"bi bi-exclamation-triangle-fill",info:"bi bi-info-circle-fill",primary:"bi bi-info-circle-fill",secondary:"bi bi-info-circle-fill",danger:"bi bi-exclamation-triangle-fill",light:"bi bi-info-circle-fill",dark:"bi bi-info-circle-fill"};return e[t]||e.info}success(t,e={}){return this.show(t,"success",e)}error(t,e={}){return this.show(t,"danger",e)}warning(t,e={}){return this.show(t,"warning",e)}info(t,e={}){return this.show(t,"info",e)}async confirm(t={}){const e={title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, proceed",cancelButtonText:"Cancel"};return(await m.fire({...e,...t})).isConfirmed}async prompt(t={}){const e={title:"Enter value",input:"text",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",inputValidator:a=>{if(!a)return"Please enter a value"}},s=await m.fire({...e,...t});return s.isConfirmed?s.value:null}async alert(t,e="info",s=""){const a={success:"success",error:"error",warning:"warning",info:"info"};await m.fire({title:s,text:t,icon:a[e]||"info",confirmButtonText:"OK"})}async showLoading(t="Loading..."){m.fire({title:t,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,willOpen:()=>{m.showLoading()}})}hideLoading(){m.close()}async showProgress(t,e){await m.fire({title:t,html:`
        <div class="progress mb-3">
          <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div id="progress-text">Starting...</div>
      `,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{const s=m.getHtmlContainer().querySelector(".progress-bar"),a=m.getHtmlContainer().querySelector("#progress-text");e&&typeof e=="function"&&e((r,n)=>{s.style.width=`${r}%`,s.setAttribute("aria-valuenow",r),n&&(a.textContent=n),r>=100&&setTimeout(()=>{m.close(),this.success("Operation completed successfully!")},500)})}})}clearAll(){this.activeToasts.forEach(t=>{t.hide()}),this.activeToasts.clear()}handleRealTimeNotification(t){const{type:e,message:s,priority:a="normal",persistent:r=!1}=t,n={persistent:a==="high"||r,duration:a==="high"?1e4:this.defaultDuration};a==="high"&&this.playNotificationSound(),this.show(s,e,n)}playNotificationSound(){const t=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiS2O/FeCkFKXnJ8N+PQAoSXrTp6qpTFAlEnt//wUfZBBmBzOvQDh8VHH/H7N4=");t.volume=.3,t.play().catch(()=>{})}addToActivityFeed(t){const e=document.querySelector(".activity-feed");if(!e)return;const s=document.createElement("div");s.className="activity-item",s.innerHTML=`
      <div class="activity-icon bg-${t.type} bg-opacity-10 text-${t.type}">
        <i class="${this.getIconForType(t.type)}"></i>
      </div>
      <div class="activity-content">
        <p class="mb-1">${t.message}</p>
        <small class="text-muted">Just now</small>
      </div>
    `,e.insertBefore(s,e.firstChild);const a=e.querySelectorAll(".activity-item");a.length>10&&a[a.length-1].remove()}async requestNotificationPermission(){return"Notification"in window?await Notification.requestPermission()==="granted":!1}showBrowserNotification(t,e={}){if("Notification"in window&&Notification.permission==="granted"){const s=new Notification(t,{icon:"/favicon.ico",badge:"/favicon.ico",...e});return setTimeout(()=>{s.close()},5e3),s}}}const Pt=992;class Ct{constructor(){if(this.wrapper=document.getElementById("admin-wrapper"),this.sidebar=document.getElementById("admin-sidebar"),this.toggleButton=document.querySelector("[data-sidebar-toggle]"),this.backdrop=document.querySelector(".sidebar-backdrop"),!this.wrapper||!this.sidebar||!this.toggleButton){console.warn("SidebarManager: Essential elements not found. Manager will be inactive.");return}this.backdrop||(this.backdrop=document.createElement("div"),this.backdrop.className="sidebar-backdrop",this.wrapper.appendChild(this.backdrop)),this.init(),this.bindEvents()}get isMobile(){return window.innerWidth<Pt}init(){this.isMobile||localStorage.getItem("sidebar-collapsed")==="true"&&(this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active"))}bindEvents(){this.toggleButton.addEventListener("click",()=>this.toggle()),this.backdrop.addEventListener("click",()=>this.closeMobile()),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isMobile&&this.sidebar.classList.contains("show")&&this.closeMobile()});let t;window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>this.handleResize(),150)})}toggle(){this.isMobile?this.toggleMobile():this.toggleDesktop()}toggleDesktop(){this.wrapper.classList.contains("sidebar-collapsed")?this.expandDesktop():this.collapseDesktop()}collapseDesktop(){this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active"),localStorage.setItem("sidebar-collapsed","true")}expandDesktop(){this.wrapper.classList.remove("sidebar-collapsed"),this.toggleButton.classList.remove("is-active"),localStorage.setItem("sidebar-collapsed","false")}toggleMobile(){this.sidebar.classList.contains("show")?this.closeMobile():this.openMobile()}openMobile(){this.sidebar.classList.add("show"),this.backdrop.classList.add("show"),document.body.style.overflow="hidden"}closeMobile(){this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow=""}handleResize(){this.isMobile?(this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow=""):(this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow="",localStorage.getItem("sidebar-collapsed")==="true"&&(this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active")))}}const At="modulepreload",It=function(i){return"/"+i},v={},kt=function(t,e,s){let a=Promise.resolve();if(e&&e.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=n?.nonce||n?.getAttribute("nonce");a=c(e.map(l=>{if(l=It(l),l in v)return;v[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":At,u||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),u)return new Promise((p,y)=>{h.addEventListener("load",p),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return a.then(n=>{for(const o of n||[])o.status==="rejected"&&r(o.reason);return t().catch(r)})};class S{constructor(){this.prefix="bi",this.icons=new Map,this.loadCommonIcons()}loadCommonIcons(){this.icons.set("dashboard","bi-speedometer2"),this.icons.set("users","bi-people"),this.icons.set("analytics","bi-graph-up"),this.icons.set("settings","bi-gear"),this.icons.set("notifications","bi-bell"),this.icons.set("search","bi-search"),this.icons.set("menu","bi-list"),this.icons.set("close","bi-x"),this.icons.set("check","bi-check"),this.icons.set("warning","bi-exclamation-triangle"),this.icons.set("info","bi-info-circle"),this.icons.set("success","bi-check-circle"),this.icons.set("error","bi-x-circle"),this.icons.set("arrow-up","bi-arrow-up"),this.icons.set("arrow-down","bi-arrow-down"),this.icons.set("plus","bi-plus"),this.icons.set("edit","bi-pencil"),this.icons.set("delete","bi-trash"),this.icons.set("download","bi-download"),this.icons.set("upload","bi-upload"),this.icons.set("home","bi-house"),this.icons.set("calendar","bi-calendar"),this.icons.set("clock","bi-clock"),this.icons.set("mail","bi-envelope"),this.icons.set("phone","bi-telephone"),this.icons.set("location","bi-geo-alt"),this.icons.set("heart","bi-heart"),this.icons.set("star","bi-star"),this.icons.set("bookmark","bi-bookmark"),this.icons.set("share","bi-share"),this.icons.set("copy","bi-clipboard"),this.icons.set("link","bi-link"),this.icons.set("external","bi-box-arrow-up-right"),this.icons.set("refresh","bi-arrow-clockwise"),this.icons.set("filter","bi-funnel"),this.icons.set("sort","bi-sort-down"),this.icons.set("grid","bi-grid"),this.icons.set("list","bi-list-ul"),this.icons.set("image","bi-image"),this.icons.set("file","bi-file-text"),this.icons.set("folder","bi-folder"),this.icons.set("eye","bi-eye"),this.icons.set("eye-slash","bi-eye-slash"),this.icons.set("lock","bi-lock"),this.icons.set("unlock","bi-unlock"),this.icons.set("user","bi-person"),this.icons.set("team","bi-people"),this.icons.set("crown","bi-crown"),this.icons.set("shield","bi-shield-check")}get(t,e="bi-question-circle"){return this.icons.get(t)||e}create(t,e="",s={}){const a=this.get(t),r=document.createElement("i");return r.className=`${a} ${e}`.trim(),Object.entries(s).forEach(([n,o])=>{r.setAttribute(n,o)}),r}createSVG(t,e=16,s=""){const a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",e),a.setAttribute("height",e),a.setAttribute("class",s),a.setAttribute("aria-hidden","true"),a}}class E{constructor(){this.icons=new Map,this.size=20,this.strokeWidth=2,this.loadLucideIcons()}async loadLucideIcons(){try{const t=await kt(()=>import("./lucide-CPfDPjHG.js"),[]).catch(()=>null);if(!t){console.info("Lucide icons not installed, using Bootstrap Icons only");return}const{BarChart3:e,Users:s,Settings:a,Bell:r,Search:n,Menu:o,X:c,Check:l,AlertTriangle:u,Info:d,CheckCircle:h,XCircle:p,ArrowUp:y,ArrowDown:C,Plus:A,Edit:I,Trash2:k,Download:L,Upload:T,Home:M,Calendar:x,Clock:N,Mail:B,Phone:$,MapPin:R,Heart:_,Star:O,Bookmark:F,Share:q,Copy:U,ExternalLink:H,RefreshCw:W,Filter:j,ArrowUpDown:V,Grid3X3:G,List:z,Image:J,FileText:K,Folder:Y,Eye:Q,EyeOff:X,Lock:Z,Unlock:tt,User:et,Crown:st,Shield:at}=t;this.icons.set("dashboard",e),this.icons.set("users",s),this.icons.set("settings",a),this.icons.set("notifications",r),this.icons.set("search",n),this.icons.set("menu",o),this.icons.set("close",c),this.icons.set("check",l),this.icons.set("warning",u),this.icons.set("info",d),this.icons.set("success",h),this.icons.set("error",p),this.icons.set("arrow-up",y),this.icons.set("arrow-down",C),this.icons.set("plus",A),this.icons.set("edit",I),this.icons.set("delete",k),this.icons.set("download",L),this.icons.set("upload",T),this.icons.set("home",M),this.icons.set("calendar",x),this.icons.set("clock",N),this.icons.set("mail",B),this.icons.set("phone",$),this.icons.set("location",R),this.icons.set("heart",_),this.icons.set("star",O),this.icons.set("bookmark",F),this.icons.set("share",q),this.icons.set("copy",U),this.icons.set("external",H),this.icons.set("refresh",W),this.icons.set("filter",j),this.icons.set("sort",V),this.icons.set("grid",G),this.icons.set("list",z),this.icons.set("image",J),this.icons.set("file",K),this.icons.set("folder",Y),this.icons.set("eye",Q),this.icons.set("eye-slash",X),this.icons.set("lock",Z),this.icons.set("unlock",tt),this.icons.set("user",et),this.icons.set("crown",st),this.icons.set("shield",at),console.info("âœ¨ Lucide icons loaded successfully")}catch{console.info("Lucide icons not available, falling back to Bootstrap Icons only")}}create(t,e={}){if(!this.icons.get(t))return console.warn(`Icon "${t}" not found in Lucide icons`),null;const{size:a=this.size,strokeWidth:r=this.strokeWidth,className:n="",color:o="currentColor"}=e,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",a),c.setAttribute("height",a),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.setAttribute("stroke",o),c.setAttribute("stroke-width",r),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("class",`lucide lucide-${t} ${n}`.trim()),c.setAttribute("aria-hidden","true");const l=document.createElementNS("http://www.w3.org/2000/svg","path");return c.appendChild(l),c}}class Lt{constructor(t="bootstrap"){this.provider=t,this.manager=t==="lucide"?new E:new S}get(t){return this.manager.get?this.manager.get(t):t}create(t,e={}){if(this.provider==="lucide")return this.manager.create(t,e);{const{className:s="",...a}=e;return this.manager.create(t,s,a)}}replaceIcon(t,e,s={}){if(this.provider==="bootstrap"){const a=this.get(e);t.className=t.className.replace(/bi-[\w-]+/g,""),t.classList.add(a)}else{const a=this.create(e,s);a&&t.parentNode&&t.parentNode.replaceChild(a,t)}}preloadIcons(t=[]){t.forEach(e=>{this.create(e)})}switchProvider(t){this.provider=t,this.manager=t==="lucide"?new E:new S}}const b=new Lt("bootstrap");function Tt(){g.data("settingsComponent",()=>({sidebarVisible:!1,activeSection:"general",confirmReset:!1,settings:{language:"en",timezone:"America/New_York",dateFormat:"MM/DD/YYYY",currencyCode:"USD",cardVisibility:{totalAssetsValue:!0,itemsCount:!0,avgPrice:!0,pendingWarranties:!0,taxDeductible:!0,expiredWarranties:!0},notifications:{desktop:!0,email:!0,sound:!1,marketing:!1},retailers:[]},sections:[{id:"general",name:"General",icon:"bi-gear"},{id:"dashboard",name:"Dashboard",icon:"bi-speedometer2"},{id:"notifications",name:"Notifications",icon:"bi-bell"},{id:"retailer",name:"Retailer",icon:"bi-shop"},{id:"data-management",name:"Data Management",icon:"bi-database"}],newRetailerName:"",retailerList:[],importFile:null,exportFormats:["JSON","CSV"],async init(){document.documentElement.getAttribute("data-bs-theme")||localStorage.getItem("theme"),this.restoreActiveSection(),this.loadSettings(),await this.loadRetailers(),setTimeout(()=>{this.hideLoadingScreen()},300)},restoreActiveSection(){const i=window.location.hash.replace("#",""),t=["general","dashboard","notifications","retailer","dataManagement"];i&&t.includes(i)&&(this.activeSection=i),window.addEventListener("hashchange",()=>{const e=window.location.hash.replace("#","");e&&t.includes(e)&&(this.activeSection=e)})},hideLoadingScreen(){const i=document.getElementById("loading-screen");i&&(i.style.opacity="0",i.style.transition="opacity 0.5s ease-out",setTimeout(()=>{i.style.display="none"},500))},loadSettings(){const i=localStorage.getItem("appSettings");if(i)try{const t=JSON.parse(i);this.settings={...this.settings,...t}}catch(t){console.warn("Failed to load saved settings:",t)}},saveSettings(){try{localStorage.setItem("appSettings",JSON.stringify(this.settings)),this.showNotification("Settings saved successfully!","success")}catch(i){this.showNotification("Failed to save settings","error"),console.error("Failed to save settings:",i)}},setActiveSection(i){this.activeSection=i,this.sidebarVisible=!1,window.history.replaceState(null,null,`#${i}`)},async loadRetailers(){try{const i=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",[t,e]=await Promise.all([fetch(`${i}/retailers`),fetch(`${i}/brands?limit=100`)]);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json(),a=e.ok?await e.json():{items:[]},r=new Set(a.items.map(o=>o.name)),n=new Map(a.items.map(o=>[o.name,o.id]));this.retailerList=s.items.map(o=>({id:o.id,name:o.name,isBrand:r.has(o.name),brandId:n.get(o.name)||null})),this.settings.retailers=this.retailerList}catch(i){console.error("Error loading retailers:",i),this.retailerList=[],this.settings.retailers=[]}},async addRetailer(){if(this.newRetailerName.trim())try{const i=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",t=await fetch(`${i}/retailers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.newRetailerName,url:""})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();this.retailerList.push({id:e.id,name:e.name,isBrand:!1}),this.settings.retailers=this.retailerList,this.newRetailerName="",this.showNotification("Retailer added successfully!","success")}catch(i){console.error("Error adding retailer:",i),this.showNotification("Failed to add retailer","error")}},async removeRetailer(i){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=this.retailerList.find(a=>a.id===i),s=await fetch(`${t}/retailers/${i}`,{method:"DELETE"});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);if(e&&e.isBrand&&e.brandId)try{await fetch(`${t}/brands/${e.brandId}`,{method:"DELETE"})}catch(a){console.warn("Failed to delete associated brand:",a)}this.retailerList=this.retailerList.filter(a=>a.id!==i),this.settings.retailers=this.retailerList,this.showNotification("Retailer removed successfully!","success")}catch(t){console.error("Error removing retailer:",t),this.showNotification("Failed to remove retailer","error")}},deleteRetailer(i){return this.removeRetailer(i)},async toggleRetailerBrand(i){const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=!i.isBrand;try{if(e){const s=await fetch(`${t}/brands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name,url:""})});if(s.ok){const a=await s.json();i.isBrand=!0,i.brandId=a.id,this.settings.retailers=this.retailerList,this.showNotification(`"${i.name}" added to Brands`,"success")}else if(s.status===409)i.isBrand=!0,this.settings.retailers=this.retailerList,this.showNotification(`"${i.name}" is already in Brands`,"info");else throw new Error(`HTTP error! status: ${s.status}`)}else{const s=await fetch(`${t}/brands?limit=100`);if(s.ok){const r=(await s.json()).items.find(n=>n.name===i.name);if(r){const n=await fetch(`${t}/brands/${r.id}`,{method:"DELETE"});if(n.ok)i.isBrand=!1,delete i.brandId,this.settings.retailers=this.retailerList,this.showNotification(`"${i.name}" removed from Brands`,"success");else throw new Error(`Failed to delete brand: ${n.status}`)}else i.isBrand=!1,delete i.brandId,this.settings.retailers=this.retailerList}}}catch(s){console.error("Error toggling brand status:",s),this.showNotification("Failed to update brand status","error"),i.isBrand=!e,this.settings.retailers=this.retailerList}},exportData(i){const t={settings:this.settings,exportDate:new Date().toISOString(),format:i};let e,s,a;i==="JSON"?(e=JSON.stringify(t,null,2),s=`data_export_${new Date().getTime()}.json`,a="application/json"):i==="CSV"&&(e=this.convertToCSV(t),s=`data_export_${new Date().getTime()}.csv`,a="text/csv");const r=new Blob([e],{type:a}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=s,n.click(),URL.revokeObjectURL(n.href),this.showNotification(`Data exported as ${i}!`,"success")},convertToCSV(i){let t=`Key,Value
`;const e=i.settings,s=(a,r="")=>{for(const n in a)if(a.hasOwnProperty(n)){const o=a[n],c=r?`${r}.${n}`:n;if(typeof o=="object"&&o!==null&&!Array.isArray(o))s(o,c);else{const l=Array.isArray(o)?JSON.stringify(o):o;t+=`"${c}","${l}"
`}}};return s(e),t},handleFileImport(i){const t=i.target.files[0];if(!t)return;const e=new FileReader;e.onload=s=>{try{const a=s.target.result;let r;t.name.endsWith(".json")?(r=JSON.parse(a),r.settings&&(this.settings={...this.settings,...r.settings},this.saveSettings(),this.showNotification("Data imported successfully from JSON!","success"))):t.name.endsWith(".csv")&&this.showNotification("CSV import received. Manual parsing required.","info")}catch(a){this.showNotification("Failed to import file","error"),console.error("Import error:",a)}},e.readAsText(t)},resetAllData(){this.confirmReset=!0},confirmResetData(){localStorage.removeItem("appSettings"),this.settings={language:"en",timezone:"America/New_York",dateFormat:"MM/DD/YYYY",currencyCode:"USD",cardVisibility:{totalAssetsValue:!0,itemsCount:!0,avgPrice:!0,pendingWarranties:!0,taxDeductible:!0,expiredWarranties:!0},notifications:{desktop:!0,email:!0,sound:!1,marketing:!1},retailers:[]},this.retailerList=[],this.confirmReset=!1,this.showNotification("All data has been reset to defaults","success")},showNotification(i,t){console.log(`[${t.toUpperCase()}] ${i}`)}}))}function Mt(){g.data("inventoryTable",()=>({items:[],filteredItems:[],selectedItems:[],paginatedItems:[],currentPage:1,itemsPerPage:10,totalPages:1,searchQuery:"",statusFilter:"",dateFilter:"",sortField:"id",sortDirection:"asc",stats:{total:0,ordered:0,received:0,totalSpending:0},async init(){await this.loadInventoryData(),this.filterInventory(),this.calculateStats(),this.updatePagination();const i=document.getElementById("inventoryModal");i&&i.addEventListener("show.bs.modal",t=>{setTimeout(()=>{const e=i.querySelector(".modal-content");if(e&&e.__x){const s=e.__x.$data;t.relatedTarget&&t.relatedTarget.classList.contains("btn-primary")&&t.relatedTarget.textContent.includes("New Purchase")&&s.resetForm(),console.log("Modal opened - isEditMode:",s.isEditMode)}},10)}),window.addEventListener("refresh-inventory",async()=>{console.log("Received refresh-inventory event"),await this.loadInventoryData(),this.filterInventory(),this.calculateStats(),this.updatePagination(),console.log("Inventory data refreshed after purchase update")}),setTimeout(()=>{this.hideLoadingScreen()},500)},hideLoadingScreen(){const i=document.getElementById("loading-screen");i&&(i.style.opacity="0",i.style.transition="opacity 0.5s ease-out",setTimeout(()=>{i.style.display="none"},500))},async loadInventoryData(){try{this.showLoadingState();const i=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",t=await fetch(`${i}/purchases/`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();this.items=e.items.map(s=>{const a=s.purchase_date,r=s.warranty?.warranty_end||s.warranty_expiry,n=s.return_deadline,o=c=>{if(!c)return"";const[l,u,d]=c.split("-").map(Number);return new Date(l,u-1,d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return{id:s.id,name:s.product_name,brand:s.brand?.name||"Unknown",retailer:s.retailer?.name||"Unknown",price:parseFloat(s.price),status:s.status?.toLowerCase()||"ordered",purchaseDate:o(a),purchaseDateISO:a,warrantyExpiry:r||"",notes:s.notes||"",taxDeductible:s.tax_deductible===1||s.tax_deductible===!0,modelNumber:s.model_number||"",serialNumber:s.serial_number||"",quantity:s.quantity||1,link:s.link||"",returnDeadline:n||"",returnPolicy:s.return_policy||"",tags:s.tags||""}}),this.hideLoadingState()}catch(i){console.error("Error loading inventory data:",i),this.hideLoadingState(),this.showErrorState(),this.loadMockInventoryData()}},loadMockInventoryData(){const i=[{name:"Apple iPhone 15 Pro",brand:"Apple",price:999},{name:"Samsung Galaxy S24",brand:"Samsung",price:899},{name:'MacBook Pro 16"',brand:"Apple",price:2499},{name:"Sony WH-1000XM5 Headphones",brand:"Sony",price:399},{name:"iPad Air",brand:"Apple",price:599},{name:"Dell XPS 13",brand:"Dell",price:1299},{name:'LG 27" Gaming Monitor',brand:"LG",price:499},{name:"Apple Watch Series 9",brand:"Apple",price:399},{name:"Sony PlayStation 5",brand:"Sony",price:499},{name:"IKEA Billy Bookshelf",brand:"IKEA",price:79.99},{name:"Bose Smart Speaker",brand:"Bose",price:199},{name:'Samsung 55" QLED TV',brand:"Samsung",price:1299},{name:"AirPods Pro Max",brand:"Apple",price:549},{name:"Mechanical Keyboard",brand:"Corsair",price:149},{name:"Wireless Mouse",brand:"Logitech",price:59.99},{name:'LG OLED TV 65"',brand:"LG",price:1999},{name:"Google Pixel 8 Pro",brand:"Google",price:999},{name:"Nintendo Switch OLED",brand:"Nintendo",price:349},{name:"Canon EOS R5",brand:"Canon",price:3899},{name:"DJI Mini 3 Pro",brand:"DJI",price:369}],t=()=>{const e=new Date(2024,6,1).getTime(),s=new Date(2025,0,31).getTime(),a=e+Math.random()*(s-e);return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};this.items=Array.from({length:20},(e,s)=>{const a=i[s%i.length],r=a.price+(Math.random()*200-100);return{id:s+1,name:a.name,brand:a.brand,price:parseFloat(r.toFixed(2)),status:Math.random()>.35?"received":"ordered",purchaseDate:t()}})},showLoadingState(){const i=document.querySelector(".table-responsive");if(i){this.hideLoadingState();const t=document.createElement("div");t.className="position-absolute top-50 start-50 translate-middle inventory-loader",t.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',t.style.zIndex="10",t.style.backgroundColor="rgba(255, 255, 255, 0.7)",t.style.padding="20px",t.style.borderRadius="5px",i.style.position="relative",i.appendChild(t)}},hideLoadingState(){const i=document.querySelector(".table-responsive");if(i){const t=i.querySelector(".inventory-loader");t&&t.remove()}},showErrorState(){const i=document.querySelector(".table-responsive");if(i){const t=document.createElement("div");t.className="alert alert-danger",t.innerHTML="<strong>Error:</strong> Failed to load inventory data. Please check your connection and try again.",i.parentNode.insertBefore(t,i)}},calculateStats(){this.stats.total=this.items.length,this.stats.ordered=this.items.filter(i=>i.status==="ordered").length,this.stats.received=this.items.filter(i=>i.status==="received").length,this.stats.totalSpending=this.items.reduce((i,t)=>i+t.price,0)},filterInventory(){this.filteredItems=this.items.filter(i=>{const t=!this.searchQuery||i.name.toLowerCase().includes(this.searchQuery.toLowerCase())||i.brand.toLowerCase().includes(this.searchQuery.toLowerCase()),e=!this.statusFilter||i.status===this.statusFilter;return t&&e}),this.sortItems(),this.currentPage=1,this.updatePagination()},sortItems(){this.filteredItems.sort((i,t)=>{let e=i[this.sortField],s=t[this.sortField];if(typeof e=="number"&&typeof s=="number")return this.sortDirection==="asc"?e-s:s-e;const a=String(e).localeCompare(String(s));return this.sortDirection==="asc"?a:-a})},sortBy(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.filterInventory()},updatePagination(){this.totalPages=Math.ceil(this.filteredItems.length/this.itemsPerPage);const i=(this.currentPage-1)*this.itemsPerPage,t=i+this.itemsPerPage;this.paginatedItems=this.filteredItems.slice(i,t)},get visiblePages(){const i=[],e=Math.floor(2.5);let s=Math.max(1,this.currentPage-e),a=Math.min(this.totalPages,s+5-1);a-s<4&&(s=Math.max(1,a-5+1)),s>1&&(i.push(1),s>2&&i.push("..."));for(let r=s;r<=a;r++)i.push(r);return a<this.totalPages&&(a<this.totalPages-1&&i.push("..."),i.push(this.totalPages)),i},goToPage(i){i>0&&i<=this.totalPages&&(this.currentPage=i,this.updatePagination())},toggleAll(i){i?this.selectedItems=this.paginatedItems.map(t=>t.id):this.selectedItems=[]},viewItem(i){console.log("View item:",i);const t={productName:i.name,retailer:i.retailer||"Amazon",brand:i.brand,modelNumber:i.modelNumber||"",serialNumber:i.serialNumber||"",purchaseDate:i.purchaseDate,price:i.price,quantity:i.quantity||1,link:i.link||"",warrantyExpiry:i.warrantyExpiry||"",returnDeadline:i.returnDeadline||"",returnPolicy:i.returnPolicy||"",taxDeductible:i.taxDeductible||!1,tags:i.tags||"",notes:i.notes||""},e=document.querySelector('[x-data="viewPurchaseDetails()"]');e&&e.__x&&e.__x.$data.setItem(t),new w(document.getElementById("viewDetailsModal")).show()},editItem(i){const t=this.items.find(r=>r.id===i.id)||i;console.log("Edit item - fresh item:",t),console.log("Edit item - modelNumber:",t.modelNumber),console.log("Edit item - serialNumber:",t.serialNumber);const e={productName:t.name,retailer:t.retailer||"",brand:t.brand||"",modelNumber:t.modelNumber||"",serialNumber:t.serialNumber||"",purchaseDate:t.purchaseDateISO||t.purchaseDate,price:t.price,quantity:t.quantity||1,link:t.link||"",warrantyExpiry:t.warrantyExpiry||"",returnDeadline:t.returnDeadline||"",returnPolicy:t.returnPolicy||"",taxDeductible:t.taxDeductible||!1,tags:t.tags||"",notes:t.notes||"",id:t.id};window.dispatchEvent(new CustomEvent("edit-purchase",{detail:{item:e}}));const s=document.getElementById("inventoryModal");new w(s).show()},deleteItem(i){confirm(`Delete "${i.name}"?`)&&(this.items=this.items.filter(t=>t.id!==i.id),this.selectedItems=this.selectedItems.filter(t=>t!==i.id),this.filterInventory(),this.calculateStats(),console.log("Item deleted:",i))}}))}class xt{constructor(){this.components=new Map,this.isInitialized=!1}async init(){if(!this.isInitialized)try{document.readyState==="loading"&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t)}),this.themeManager=new St,this.notificationManager=new Dt,this.sidebarManager=new Ct,this.iconManager=b,this.iconManager.preloadIcons(["dashboard","purchases","analytics","settings","notifications","search","menu","check","warning","info","success","error"]),this.initBootstrapComponents(),await this.initPageComponents(),this.setupEventListeners(),this.initNavigation(),this.initTooltipsAndPopovers(),this.initAlpine(),this.isInitialized=!0,window.scrollTo(0,0),console.log("ðŸš€ Admin App initialized successfully"),this.hideLoadingScreen()}catch(t){console.error("âŒ Failed to initialize Admin App:",t)}}initBootstrapComponents(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(t=>{new it(t)}),document.querySelectorAll(".modal").forEach(t=>{new w(t)}),document.querySelectorAll(".offcanvas").forEach(t=>{new rt(t)}),document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(t=>{new nt(t)}),document.querySelectorAll('[data-bs-toggle="tab"]').forEach(t=>{new ot(t)}),document.querySelectorAll(".toast").forEach(t=>{new D(t)})}initTooltipsAndPopovers(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(t=>{new ct(t)}),document.querySelectorAll('[data-bs-toggle="popover"]').forEach(t=>{new lt(t)})}async initPageComponents(){switch(document.body.dataset.page){case"dashboard":const e=new Et;this.components.set("dashboard",e),window.dashboardManager=e;break;case"settings":console.log("âš™ï¸ Settings page components registered");break;case"inventory":console.log("ðŸ“¦ Inventory page components registered");break;default:console.log("Page-specific components loading complete")}}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches("[data-theme-toggle]")&&this.themeManager.toggleTheme()}),document.addEventListener("click",t=>{t.target.closest("[data-fullscreen-toggle]")&&(t.preventDefault(),this.toggleFullscreen())}),document.addEventListener("keydown",t=>{this.handleKeyboardShortcuts(t)})}handleKeyboardShortcuts(t){if((t.ctrlKey||t.metaKey)&&t.key==="k"){t.preventDefault();const e=document.querySelector("[data-search-input]");e&&e.focus()}}hideLoadingScreen(){const t=document.getElementById("loading-screen");t&&(t.style.opacity="0",t.style.transition="opacity 0.5s ease-out",setTimeout(()=>{t.style.display="none"},500))}async toggleFullscreen(){try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(t){console.error("Fullscreen toggle failed:",t)}}getComponent(t){return this.components.get(t)}initNavigation(){document.addEventListener("click",e=>{const s=e.target.closest('[data-bs-toggle="collapse"]');if(s){const a=s.getAttribute("data-bs-target"),r=s.getAttribute("aria-expanded")==="true";localStorage.setItem(`submenu-${a}`,(!r).toString())}}),document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(e=>{const s=e.getAttribute("data-bs-target");if(localStorage.getItem(`submenu-${s}`)==="true"){const r=document.querySelector(s);r&&(r.classList.add("show"),e.setAttribute("aria-expanded","true"))}})}initAlpine(){g.data("searchComponent",()=>({query:"",results:[],isLoading:!1,async search(){if(this.query.length<2){this.results=[];return}this.isLoading=!0,await new Promise(t=>setTimeout(t,300)),this.results=[{title:"Dashboard",url:"index.html",type:"page"},{title:"Inventory",url:"inventory.html",type:"page"},{title:"Settings",url:"settings.html",type:"page"}].filter(t=>t.title.toLowerCase().includes(this.query.toLowerCase())),this.isLoading=!1}})),g.data("statsCounter",(t=0,e=1)=>({value:t,init(){setInterval(()=>{this.value+=Math.floor(Math.random()*e)+1},5e3)}})),g.data("themeSwitch",()=>({currentTheme:"light",init(){this.currentTheme=localStorage.getItem("theme")||"light"},toggle(){this.currentTheme=this.currentTheme==="light"?"dark":"light",document.documentElement.setAttribute("data-bs-theme",this.currentTheme),localStorage.setItem("theme",this.currentTheme)}})),g.data("iconDemo",()=>({currentProvider:"bootstrap",switchProvider(t){this.currentProvider=t,b.switchProvider(t),console.log(`ðŸŽ¨ Switched to ${t} icons`)},getIcon(t){return b.get(t)}})),g.data("quickAddForm",()=>({itemType:"task",title:"",description:"",priority:"medium",dateTime:"",assignee:"",init(){const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),this.dateTime=t.toISOString().slice(0,16)},resetForm(){this.itemType="task",this.title="",this.description="",this.priority="medium",this.assignee="";const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),this.dateTime=t.toISOString().slice(0,16)},saveItem(){if(!this.title.trim()){window.AdminApp.notificationManager.warning("Please enter a title");return}const t={type:this.itemType,title:this.title,description:this.description,priority:this.itemType==="task"?this.priority:null,dateTime:["event","reminder"].includes(this.itemType)?this.dateTime:null,assignee:this.itemType==="task"?this.assignee:null,createdAt:new Date().toISOString()};console.log("New item created:",t);const e={task:"Task",note:"Note",event:"Event",reminder:"Reminder"};window.AdminApp.notificationManager.success(`${e[this.itemType]} "${this.title}" created successfully!`),this.resetForm()}})),g.data("addPurchaseForm",()=>({form:{productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},isEditMode:!1,editingItemId:null,retailers:[],brands:[],async init(){this.resetForm(),await this.loadRetailers(),await this.loadBrands(),window.addEventListener("edit-purchase",t=>{console.log("Received edit-purchase event:",t.detail),t.detail&&t.detail.item&&this.enterEditMode(t.detail.item)})},enterEditMode(t){this.isEditMode=!0,this.editingItemId=t.id,this.form.productName=t.productName||"",this.form.retailer=t.retailer||"",this.form.brand=t.brand||"",this.form.modelNumber=t.modelNumber||"",this.form.serialNumber=t.serialNumber||"",this.form.purchaseDate=t.purchaseDate||"",this.form.price=t.price||"",this.form.quantity=t.quantity||1,this.form.link=t.link||"",this.form.warrantyExpiry=t.warrantyExpiry||"",this.form.returnDeadline=t.returnDeadline||"",this.form.returnPolicy=t.returnPolicy||"",this.form.taxDeductible=t.taxDeductible||!1,this.form.tags=t.tags||"",this.form.notes=t.notes||"",console.log("Entered edit mode with item:",t),console.log("Form retailer set to:",this.form.retailer),console.log("Form brand set to:",this.form.brand)},get isBrandRetailer(){if(!this.form.retailer)return!1;const t=this.retailers.find(e=>e.name===this.form.retailer);return console.log("Checking isBrandRetailer:",this.form.retailer,"found:",t,"is_brand:",t?.is_brand),t&&t.is_brand},onRetailerChange(){this.isBrandRetailer?this.form.brand=this.form.retailer:this.isEditMode||(this.form.brand="")},async loadRetailers(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/retailers/`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();this.retailers=s.items||[]}catch(t){console.error("Error loading retailers:",t),this.retailers=[]}},async loadBrands(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/brands/`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();this.brands=s.items||[]}catch(t){console.error("Error loading brands:",t),this.brands=[]}},resetForm(){this.form={productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},this.isEditMode=!1,this.editingItemId=null},savePurchase(){if(!this.form.productName.trim()){window.AdminApp.notificationManager.warning("Please enter a product name");return}if(!this.form.retailer.trim()){window.AdminApp.notificationManager.warning("Please select a retailer");return}if(!this.form.brand.trim()){window.AdminApp.notificationManager.warning("Please enter a brand");return}if(!this.form.purchaseDate){window.AdminApp.notificationManager.warning("Please enter a purchase date");return}if(!this.form.price){window.AdminApp.notificationManager.warning("Please enter a price");return}if(this.form.warrantyExpiry&&this.form.warrantyExpiry<this.form.purchaseDate){window.AdminApp.notificationManager.warning("Warranty expiry date cannot be before purchase date");return}if(this.form.returnDeadline&&this.form.returnDeadline<this.form.purchaseDate){window.AdminApp.notificationManager.warning("Return deadline cannot be before purchase date");return}const t={productName:this.form.productName,retailer:this.form.retailer,brand:this.form.brand,modelNumber:this.form.modelNumber,serialNumber:this.form.serialNumber,purchaseDate:this.form.purchaseDate,price:parseFloat(this.form.price),quantity:parseInt(this.form.quantity)||1,link:this.form.link,warrantyExpiry:this.form.warrantyExpiry||null,returnDeadline:this.form.returnDeadline||null,returnPolicy:this.form.returnPolicy,taxDeductible:this.form.taxDeductible,tags:this.form.tags,notes:this.form.notes,createdAt:new Date().toISOString()};console.log("New purchase created:",t),this.submitPurchaseToAPI(t)},async getOrCreateRetailer(t,e){let s=this.retailers.find(n=>n.name.toLowerCase()===e.toLowerCase());if(s)return s.id;const a=await fetch(`${t}/retailers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,url:""})});if(!a.ok)throw new Error("Failed to create retailer");const r=await a.json();return this.retailers.push(r),r.id},async getOrCreateBrand(t,e){let s=this.brands.find(n=>n.name.toLowerCase()===e.toLowerCase());if(s)return s.id;const a=await fetch(`${t}/brands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,url:""})});if(!a.ok)throw new Error("Failed to create brand");const r=await a.json();return this.brands.push(r),r.id},async submitPurchaseToAPI(t){try{const e=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",s=await this.getOrCreateRetailer(e,t.retailer),a=await this.getOrCreateBrand(e,t.brand),r={product_name:t.productName,price:t.price,purchase_date:t.purchaseDate,retailer_id:s,brand_id:a,status:"RECEIVED",notes:t.notes,tax_deductible:t.taxDeductible?1:0,warranty_expiry:t.warrantyExpiry||null,model_number:t.modelNumber||null,serial_number:t.serialNumber||null,quantity:parseInt(t.quantity)||1,link:t.link||null,return_deadline:t.returnDeadline||null,return_policy:t.returnPolicy||null,tags:t.tags||null},n=this.isEditMode&&this.editingItemId,o=n?`${e}/purchases/${this.editingItemId}`:`${e}/purchases`,l=await fetch(o,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok){const p=await l.json().catch(()=>({}));throw new Error(p.detail||`HTTP error! status: ${l.status}`)}const u=await l.json();console.log("Purchase saved to API:",u);const d=n?`Purchase "${this.form.productName}" updated successfully!`:`Purchase "${this.form.productName}" created successfully!`,h=document.getElementById("newItemModal");if(h){const p=w.getInstance(h);p&&p.hide()}this.resetForm(),window.AdminApp.notificationManager.success(d),setTimeout(async()=>{console.log("Refreshing data after purchase...");const p=document.querySelector('[data-page="dashboard"]');console.log("Is dashboard:",!!p,"dashboardManager:",!!window.dashboardManager),window.dashboardManager&&p&&(console.log("Refreshing dashboard data..."),await window.dashboardManager.loadDashboardData(),console.log("Dashboard data refreshed")),window.location.pathname.includes("inventory")&&(console.log("Refreshing inventory data..."),window.dispatchEvent(new CustomEvent("refresh-inventory")))},1e3)}catch(e){console.error("Error saving purchase:",e),window.AdminApp.notificationManager.error(`Failed to save purchase: ${e.message}`)}}})),g.data("viewPurchaseDetails",()=>({item:{productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},init(){},setItem(t){this.item={...t}},editItem(){console.log("Edit item:",this.item)}})),Tt(),Mt(),g.start(),window.Alpine=g}showDemoNotifications(){setTimeout(()=>{this.notificationManager.info("New purchase added",{action:{text:"View",handler:'window.location.href="/purchases"'}})},3e3),setTimeout(()=>{this.notificationManager.warning("Server maintenance in 10 minutes")},6e3),setTimeout(()=>{this.notificationManager.success("Backup completed successfully")},9e3)}destroy(){this.components.forEach(t=>{t.destroy&&t.destroy()}),this.components.clear(),this.isInitialized=!1}}const P=new xt;P.init();window.AdminApp=P;window.IconManager=b;
