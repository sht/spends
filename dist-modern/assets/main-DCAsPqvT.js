import{T as E,M as w,D as rt,O as it,C as nt,a as ot,b as ct,P as lt}from"./vendor-bootstrap-C9iorZI5.js";import{C as f,a as dt,L as ht,P as ut,b as pt,c as mt,D as gt,p as ft,d as bt,e as wt,A as yt,i as vt}from"./vendor-charts-TarMSkGa.js";import{S as m,m as g}from"./vendor-ui-CflGdlft.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class St{constructor(){this.currentTheme=this.getStoredTheme()||this.getPreferredTheme(),this.themeToggleButtons=[],this.init()}init(){this.setTheme(this.currentTheme),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.getStoredTheme()||this.setTheme(t.matches?"dark":"light")})}getStoredTheme(){return localStorage.getItem("theme")}getPreferredTheme(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}setTheme(t){document.documentElement.setAttribute("data-bs-theme",t),localStorage.setItem("theme",t),this.currentTheme=t,this.updateThemeIcons()}toggleTheme(){const t=this.currentTheme==="light"?"dark":"light";this.setTheme(t)}updateThemeIcons(){const t=document.querySelectorAll(".theme-icon-light"),e=document.querySelectorAll(".theme-icon-dark");this.currentTheme==="dark"?(t.forEach(a=>a.classList.add("d-none")),e.forEach(a=>a.classList.remove("d-none"))):(t.forEach(a=>a.classList.remove("d-none")),e.forEach(a=>a.classList.add("d-none")))}getCurrentTheme(){return this.currentTheme}}f.register(dt,ht,ut,pt,mt,gt,ft,bt,wt,yt,vt);class Dt{constructor(){this.charts=new Map,this.data={warranty:[],spending:[],retailers:[],brands:[],topProducts:[],orders:[],recentOrders:[]},this.init()}async init(){console.log("ðŸ“Š Dashboard initialized"),await this.loadDashboardData(),this.initWarrantyCharts(),this.initSpendingCharts(),this.initOrderStatusCharts(),this.populateTopProducts(),this.populateRecentOrders()}async loadDashboardData(){try{const t=document.querySelector('button[title="Refresh data"] i');t&&t.classList.add("icon-spin"),this.showLoadingState();const[e,a,s,i,n,o,c]=await Promise.all([this.fetchWarrantyData(),this.fetchSpendingData(),this.fetchRetailersData(),this.fetchBrandsData(),this.fetchTopProductsData(),this.fetchRecentOrdersData(),this.fetchSummaryData()]);this.updateKPICards(c),this.data.warranty=e,this.data.spending=a,this.data.retailers=s,this.data.brands=i,this.data.topProducts=n,this.data.recentOrders=o,this.data.orders=this.calculateOrderData(o),this.updateCharts(),this.populateTopProducts(),this.populateRecentOrders(),this.hideLoadingState()}catch(t){console.error("Error loading dashboard data:",t),this.showErrorState()}finally{const t=document.querySelector('button[title="Refresh data"] i');t&&t.classList.remove("icon-spin")}}updateCharts(){this.charts.forEach((t,e)=>{e.startsWith("warranty-")?(t.data.labels=this.data.warranty.map(a=>a.month),t.data.datasets[0].data=this.data.warranty.map(a=>a.active),t.data.datasets[1].data=this.data.warranty.map(a=>a.expired),t.data.datasets[2]&&(t.data.datasets[2].data=this.data.warranty.map(a=>a.expiring_soon)),t.update("none")):e==="spending"?(t.data.labels=this.data.spending.map(a=>a.month),t.data.datasets[0].data=this.data.spending.map(a=>a.totalSpending),t.data.datasets[1].data=this.data.spending.map(a=>a.itemsCount),t.update("none")):e==="retailers"?(t.data.labels=this.data.retailers.map(a=>a.name),t.data.datasets[0].data=this.data.retailers.map(a=>Math.round(a.percentage)),t.update("none")):e==="brands"&&(t.data.labels=this.data.brands.map(a=>a.name),t.data.datasets[0].data=this.data.brands.map(a=>Math.round(a.percentage)),t.update("none"))})}async fetchWarrantyData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/warranties/timeline`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).timeline||[]}catch(t){return console.error("Error fetching warranty data:",t),this.generateWarrantyData()}}async fetchSpendingData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/spending`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return((await e.json()).spending_over_time||[]).map(s=>({month:s.month,totalSpending:parseFloat(s.total_amount),itemsCount:s.item_count}))}catch(t){return console.error("Error fetching spending data:",t),this.generateSpendingData()}}async fetchRetailersData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/retailers`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).retailers||[]}catch(t){return console.error("Error fetching retailers data:",t),this.generateRetailerData()}}async fetchBrandsData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/brands`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).brands||[]}catch(t){return console.error("Error fetching brands data:",t),this.generateBrandData()}}async fetchTopProductsData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/top-products`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return((await e.json()).top_products||[]).map((s,i)=>({rank:i+1,name:s.product_name,price:"$"+parseFloat(s.avg_price).toLocaleString(),date:new Date().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}))}catch(t){return console.error("Error fetching top products data:",t),this.generateTopProducts()}}async fetchRecentOrdersData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/recent-purchases?limit=10`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()||[]).map(s=>({id:s.id.substring(0,8)+"...",customer:s.product_name,amount:"$"+parseFloat(s.price).toLocaleString(),status:{class:s.status==="RECEIVED"?"bg-success":"bg-warning",text:s.status},date:new Date(s.purchase_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}))}catch(t){return console.error("Error fetching recent orders data:",t),this.generateRecentOrders()}}async fetchSummaryData(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/analytics/summary`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){return console.error("Error fetching summary data:",t),null}}updateKPICards(t){if(!t)return;const e=document.querySelector('[data-kpi="total-value"] .kpi-value');e&&t.total_spent!==void 0&&(e.textContent="$"+parseFloat(t.total_spent).toLocaleString());const a=document.querySelector('[data-kpi="items-count"] .kpi-value');a&&t.total_items!==void 0&&(a.textContent=t.total_items.toLocaleString());const s=document.querySelector('[data-kpi="avg-price"] .kpi-value');s&&t.avg_price!==void 0&&(s.textContent="$"+Math.round(parseFloat(t.avg_price)).toLocaleString());const i=document.querySelector('[data-kpi="active-warranties"] .kpi-value');i&&t.active_warranties!==void 0&&(i.textContent=t.active_warranties.toLocaleString());const n=document.querySelector('[data-kpi="tax-deductible"] .kpi-value');n&&t.tax_deductible_count!==void 0&&(n.textContent=t.tax_deductible_count.toLocaleString());const o=document.querySelector('[data-kpi="expired-warranties"] .kpi-value');o&&t.expired_warranties!==void 0&&(o.textContent=t.expired_warranties.toLocaleString())}calculateOrderData(t){const e=t.filter(n=>n.status==="RECEIVED").length,a=t.filter(n=>n.status==="ORDERED").length,s=t.filter(n=>n.status==="PENDING").length,i=t.length-(e+a+s);return{completed:e,processing:a,pending:s,cancelled:i}}showLoadingState(){document.querySelectorAll(".card").forEach(e=>{const a=document.createElement("div");a.className="position-absolute top-50 start-50 translate-middle",a.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',a.style.zIndex="10",e.style.position="relative",e.appendChild(a)})}hideLoadingState(){document.querySelectorAll(".spinner-border").forEach(e=>e.remove())}showErrorState(){const t=document.createElement("div");t.className="alert alert-danger",t.innerHTML="<strong>Error:</strong> Failed to load dashboard data. Please check your connection and try again.";const e=document.querySelector(".container-fluid")||document.body;e.insertBefore(t,e.firstChild),this.data.warranty=this.generateWarrantyData(),this.data.spending=this.generateSpendingData(),this.data.retailers=this.generateRetailerData(),this.data.brands=this.generateBrandData(),this.data.topProducts=this.generateTopProducts(),this.data.orders=this.generateOrderData(),this.data.recentOrders=this.generateRecentOrders()}generateWarrantyData(){const t=new Date(2025,3,1),e=[];for(let a=0;a<12;a++){const s=new Date(t);s.setMonth(s.getMonth()+a);const i=s.toLocaleDateString("en-US",{month:"short",year:"2-digit"});e.push(i)}return e.map(a=>({month:a,active:Math.floor(Math.random()*30)+20,expired:Math.floor(Math.random()*15)+5,expiring_soon:Math.floor(Math.random()*10)+2}))}generateSpendingData(){const t=new Date(2025,3,1),e=[];for(let a=0;a<12;a++){const s=new Date(t);s.setMonth(s.getMonth()+a);const i=s.toLocaleDateString("en-US",{month:"short",year:"2-digit"});e.push(i)}return e.map(a=>({month:a,totalSpending:Math.floor(Math.random()*3e3)+1e3,itemsCount:Math.floor(Math.random()*15)+5}))}generateRetailerData(){return["Amazon","eBay","Walmart","Target","Best Buy"].map(e=>({name:e,count:Math.floor(Math.random()*10)+1,percentage:Math.floor(Math.random()*30)+10}))}generateBrandData(){return["Apple","Sony","Samsung","LG","Dell"].map(e=>({name:e,count:Math.floor(Math.random()*10)+1,percentage:Math.floor(Math.random()*25)+10}))}generateTopProducts(){const t=['MacBook Pro 16"',"iPhone 15 Pro Max","Sony WH-1000XM5 Headphones",'Samsung 55" QLED TV',"iPad Air","Dell XPS 13 Laptop","AirPods Pro",'LG 27" Gaming Monitor',"Apple Watch Series 9","Sony PlayStation 5"],e=()=>{const a=new Date(2021,9,1).getTime(),s=new Date(2026,0,31).getTime(),i=a+Math.random()*(s-a);return new Date(i).toLocaleDateString()};return t.map((a,s)=>({rank:s+1,name:a,price:`$${(Math.random()*2e3+100).toFixed(2)}`,date:e()}))}generateOrderData(){return{completed:1245,processing:156,pending:87,cancelled:23}}generateRecentOrders(){const t=["Bose Speaker","iPhone 15",'MacBook Pro 14"',"IKEA Bookshelf","Wireless Mouse","USB-C Hub","Monitor Stand","Desk Lamp","Mechanical Keyboard","Webcam 4K"],e=[{text:"Ordered",class:"bg-primary"},{text:"Received",class:"bg-success"}],a=()=>{const s=new Date(2021,9,1).getTime(),i=new Date(2026,0,31).getTime(),n=s+Math.random()*(i-s);return new Date(n).toLocaleDateString()};return Array.from({length:10},()=>({id:`#${Math.floor(Math.random()*9e3)+1e3}`,customer:t[Math.floor(Math.random()*t.length)],amount:`$${(Math.random()*500+50).toFixed(2)}`,status:e[Math.floor(Math.random()*e.length)],date:a()}))}initWarrantyCharts(){document.querySelectorAll("canvas#warrantyChart").forEach((e,a)=>{const s=new f(e,{type:"line",data:{labels:this.data.warranty.map(i=>i.month),datasets:[{label:"Active Warranties",data:this.data.warranty.map(i=>i.active),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(16, 185, 129)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8},{label:"Expired Warranties",data:this.data.warranty.map(i=>i.expired),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(239, 68, 68)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8},{label:"Expiring Soon",data:this.data.warranty.map(i=>i.expiring_soon),borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(245, 158, 11)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(i){return`${i.dataset.label}: ${i.parsed.y} warranties`}}}},scales:{x:{grid:{display:!1},border:{display:!1}},y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},border:{display:!1},ticks:{stepSize:1,precision:0,callback:function(i){return Math.round(i)+" warranties"}}}}}});this.charts.set(`warranty-${a}`,s)})}initSpendingCharts(){document.querySelectorAll("canvas#spendingChart").forEach((e,a)=>{const s=new f(e,{type:"line",data:{labels:this.data.spending.map(i=>i.month),datasets:[{label:"Total Spending",data:this.data.spending.map(i=>i.totalSpending),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(59, 130, 246)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,yAxisID:"y"},{label:"Items Purchased",data:this.data.spending.map(i=>i.itemsCount),borderColor:"rgb(20, 184, 166)",backgroundColor:"rgba(20, 184, 166, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgb(20, 184, 166)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(i){return i.datasetIndex===0?`${i.dataset.label}: $${i.parsed.y.toLocaleString()}`:`${i.dataset.label}: ${i.parsed.y} items`}}}},scales:{x:{grid:{display:!1},border:{display:!1}},y:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},border:{display:!1},ticks:{callback:function(i){return"$"+i.toLocaleString()}},title:{display:!0,text:"Total Spending ($)",color:"rgb(59, 130, 246)"}},y1:{type:"linear",display:!0,position:"right",beginAtZero:!0,grid:{drawOnChartArea:!1},border:{display:!1},ticks:{stepSize:1,precision:0,callback:function(i){return i+" items"}},title:{display:!0,text:"Items Purchased",color:"rgb(20, 184, 166)"}}}}});this.charts.set("spending",s)})}initOrderStatusCharts(){document.querySelectorAll("canvas#orderStatusChart").forEach((e,a)=>{const i=e.closest(".card")?.querySelector(".card-header")?.textContent.includes("Retailers"),n=i?this.data.retailers:this.data.brands,o=n.map(d=>d.name),c=n.map(d=>Math.round(d.percentage)),l=["rgba(16, 185, 129, 0.8)","rgba(99, 102, 241, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],u=new f(e,{type:"doughnut",data:{labels:o,datasets:[{data:c,backgroundColor:l.slice(0,c.length),borderWidth:0,cutout:"60%"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(d){const h=d.label||"",p=Math.round(d.parsed);return`${h}: ${p}%`}}}}}});this.charts.set(i?"retailers":"brands",u)})}populateTopProducts(){const t=document.querySelector("tbody#top-products-table");if(!t)return;const e=this.data.topProducts.map(a=>`
        <tr>
            <td><strong>#${a.rank}</strong></td>
            <td>${a.name}</td>
            <td>${a.price}</td>
            <td>${a.date}</td>
        </tr>
    `).join("");t.innerHTML=e}populateRecentOrders(){const t=document.querySelectorAll("tbody#recent-orders-table"),e=this.data.recentOrders.map(a=>`
        <tr>
            <td><strong>${a.id}</strong></td>
            <td>${a.customer}</td>
            <td>${a.amount}</td>
            <td><span class="badge ${a.status.class}">${a.status.text}</span></td>
            <td>${a.date}</td>
        </tr>
    `).join("");t.forEach(a=>{a.innerHTML=e})}destroy(){this.charts.forEach(t=>t.destroy()),this.charts.clear()}}class Et{constructor(){this.container=document.getElementById("toast-container")||this.createToastContainer(),this.defaultDuration=5e3,this.activeToasts=new Set,this.init()}init(){this.container||(this.container=this.createToastContainer()),this.configureSweetAlert()}createToastContainer(){const t=document.createElement("div");return t.id="toast-container",t.className="position-fixed top-0 end-0 p-3",t.style.zIndex="9999",t.style.marginTop="70px",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),document.body.appendChild(t),t}configureSweetAlert(){m.mixin({customClass:{confirmButton:"btn btn-primary me-2",cancelButton:"btn btn-secondary",popup:"rounded-3 shadow-lg",title:"fs-4 fw-bold",content:"text-muted"},buttonsStyling:!1,reverseButtons:!0,focusConfirm:!1,allowOutsideClick:!0,allowEscapeKey:!0,showCloseButton:!0})}show(t,e="info",a={}){const s={message:t,type:e,duration:a.duration||this.defaultDuration,persistent:a.persistent||!1,action:a.action||null,icon:a.icon||this.getIconForType(e)},i=this.createToast(s);this.container.appendChild(i);const n=new E(i,{autohide:!s.persistent,delay:s.duration});return this.activeToasts.add(n),i.addEventListener("hidden.bs.toast",()=>{this.activeToasts.delete(n),i.remove()}),n.show(),n}createToast(t){const e=`toast-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a=document.createElement("div");a.className=`toast align-items-center text-bg-${t.type} border-0`,a.id=e,a.role="alert",a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true");const s=t.persistent?"":`
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    `,i=t.action?`
      <button type="button" class="btn btn-sm btn-outline-light me-2" onclick="${t.action.handler}">
        ${t.action.text}
      </button>
    `:"";return a.innerHTML=`
      <div class="d-flex">
        <div class="toast-body d-flex align-items-center">
          <i class="${t.icon} me-2"></i>
          <span class="flex-grow-1">${t.message}</span>
          ${i}
        </div>
        ${s}
      </div>
    `,a}getIconForType(t){const e={success:"bi bi-check-circle-fill",error:"bi bi-exclamation-triangle-fill",warning:"bi bi-exclamation-triangle-fill",info:"bi bi-info-circle-fill",primary:"bi bi-info-circle-fill",secondary:"bi bi-info-circle-fill",danger:"bi bi-exclamation-triangle-fill",light:"bi bi-info-circle-fill",dark:"bi bi-info-circle-fill"};return e[t]||e.info}success(t,e={}){return this.show(t,"success",e)}error(t,e={}){return this.show(t,"danger",e)}warning(t,e={}){return this.show(t,"warning",e)}info(t,e={}){return this.show(t,"info",e)}async confirm(t={}){const e={title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, proceed",cancelButtonText:"Cancel"};return(await m.fire({...e,...t})).isConfirmed}async prompt(t={}){const e={title:"Enter value",input:"text",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",inputValidator:s=>{if(!s)return"Please enter a value"}},a=await m.fire({...e,...t});return a.isConfirmed?a.value:null}async alert(t,e="info",a=""){const s={success:"success",error:"error",warning:"warning",info:"info"};await m.fire({title:a,text:t,icon:s[e]||"info",confirmButtonText:"OK"})}async showLoading(t="Loading..."){m.fire({title:t,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,willOpen:()=>{m.showLoading()}})}hideLoading(){m.close()}async showProgress(t,e){await m.fire({title:t,html:`
        <div class="progress mb-3">
          <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div id="progress-text">Starting...</div>
      `,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{const a=m.getHtmlContainer().querySelector(".progress-bar"),s=m.getHtmlContainer().querySelector("#progress-text");e&&typeof e=="function"&&e((i,n)=>{a.style.width=`${i}%`,a.setAttribute("aria-valuenow",i),n&&(s.textContent=n),i>=100&&setTimeout(()=>{m.close(),this.success("Operation completed successfully!")},500)})}})}clearAll(){this.activeToasts.forEach(t=>{t.hide()}),this.activeToasts.clear()}handleRealTimeNotification(t){const{type:e,message:a,priority:s="normal",persistent:i=!1}=t,n={persistent:s==="high"||i,duration:s==="high"?1e4:this.defaultDuration};s==="high"&&this.playNotificationSound(),this.show(a,e,n)}playNotificationSound(){const t=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMcBjiS2O/FeCkFKXnJ8N+PQAoSXrTp6qpTFAlEnt//wUfZBBmBzOvQDh8VHH/H7N4=");t.volume=.3,t.play().catch(()=>{})}addToActivityFeed(t){const e=document.querySelector(".activity-feed");if(!e)return;const a=document.createElement("div");a.className="activity-item",a.innerHTML=`
      <div class="activity-icon bg-${t.type} bg-opacity-10 text-${t.type}">
        <i class="${this.getIconForType(t.type)}"></i>
      </div>
      <div class="activity-content">
        <p class="mb-1">${t.message}</p>
        <small class="text-muted">Just now</small>
      </div>
    `,e.insertBefore(a,e.firstChild);const s=e.querySelectorAll(".activity-item");s.length>10&&s[s.length-1].remove()}async requestNotificationPermission(){return"Notification"in window?await Notification.requestPermission()==="granted":!1}showBrowserNotification(t,e={}){if("Notification"in window&&Notification.permission==="granted"){const a=new Notification(t,{icon:"/favicon.ico",badge:"/favicon.ico",...e});return setTimeout(()=>{a.close()},5e3),a}}}const Pt=992;class At{constructor(){if(this.wrapper=document.getElementById("admin-wrapper"),this.sidebar=document.getElementById("admin-sidebar"),this.toggleButton=document.querySelector("[data-sidebar-toggle]"),this.backdrop=document.querySelector(".sidebar-backdrop"),!this.wrapper||!this.sidebar||!this.toggleButton){console.warn("SidebarManager: Essential elements not found. Manager will be inactive.");return}this.backdrop||(this.backdrop=document.createElement("div"),this.backdrop.className="sidebar-backdrop",this.wrapper.appendChild(this.backdrop)),this.init(),this.bindEvents()}get isMobile(){return window.innerWidth<Pt}init(){this.isMobile||localStorage.getItem("sidebar-collapsed")==="true"&&(this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active"))}bindEvents(){this.toggleButton.addEventListener("click",()=>this.toggle()),this.backdrop.addEventListener("click",()=>this.closeMobile()),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isMobile&&this.sidebar.classList.contains("show")&&this.closeMobile()});let t;window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>this.handleResize(),150)})}toggle(){this.isMobile?this.toggleMobile():this.toggleDesktop()}toggleDesktop(){this.wrapper.classList.contains("sidebar-collapsed")?this.expandDesktop():this.collapseDesktop()}collapseDesktop(){this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active"),localStorage.setItem("sidebar-collapsed","true")}expandDesktop(){this.wrapper.classList.remove("sidebar-collapsed"),this.toggleButton.classList.remove("is-active"),localStorage.setItem("sidebar-collapsed","false")}toggleMobile(){this.sidebar.classList.contains("show")?this.closeMobile():this.openMobile()}openMobile(){this.sidebar.classList.add("show"),this.backdrop.classList.add("show"),document.body.style.overflow="hidden"}closeMobile(){this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow=""}handleResize(){this.isMobile?(this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow=""):(this.sidebar.classList.remove("show"),this.backdrop.classList.remove("show"),document.body.style.overflow="",localStorage.getItem("sidebar-collapsed")==="true"&&(this.wrapper.classList.add("sidebar-collapsed"),this.toggleButton.classList.add("is-active")))}}const Ct="modulepreload",It=function(r){return"/"+r},v={},Lt=function(t,e,a){let s=Promise.resolve();if(e&&e.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=n?.nonce||n?.getAttribute("nonce");s=c(e.map(l=>{if(l=It(l),l in v)return;v[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Ct,u||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),u)return new Promise((p,y)=>{h.addEventListener("load",p),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(n){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n}return s.then(n=>{for(const o of n||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})};class S{constructor(){this.prefix="bi",this.icons=new Map,this.loadCommonIcons()}loadCommonIcons(){this.icons.set("dashboard","bi-speedometer2"),this.icons.set("users","bi-people"),this.icons.set("analytics","bi-graph-up"),this.icons.set("settings","bi-gear"),this.icons.set("notifications","bi-bell"),this.icons.set("search","bi-search"),this.icons.set("menu","bi-list"),this.icons.set("close","bi-x"),this.icons.set("check","bi-check"),this.icons.set("warning","bi-exclamation-triangle"),this.icons.set("info","bi-info-circle"),this.icons.set("success","bi-check-circle"),this.icons.set("error","bi-x-circle"),this.icons.set("arrow-up","bi-arrow-up"),this.icons.set("arrow-down","bi-arrow-down"),this.icons.set("plus","bi-plus"),this.icons.set("edit","bi-pencil"),this.icons.set("delete","bi-trash"),this.icons.set("download","bi-download"),this.icons.set("upload","bi-upload"),this.icons.set("home","bi-house"),this.icons.set("calendar","bi-calendar"),this.icons.set("clock","bi-clock"),this.icons.set("mail","bi-envelope"),this.icons.set("phone","bi-telephone"),this.icons.set("location","bi-geo-alt"),this.icons.set("heart","bi-heart"),this.icons.set("star","bi-star"),this.icons.set("bookmark","bi-bookmark"),this.icons.set("share","bi-share"),this.icons.set("copy","bi-clipboard"),this.icons.set("link","bi-link"),this.icons.set("external","bi-box-arrow-up-right"),this.icons.set("refresh","bi-arrow-clockwise"),this.icons.set("filter","bi-funnel"),this.icons.set("sort","bi-sort-down"),this.icons.set("grid","bi-grid"),this.icons.set("list","bi-list-ul"),this.icons.set("image","bi-image"),this.icons.set("file","bi-file-text"),this.icons.set("folder","bi-folder"),this.icons.set("eye","bi-eye"),this.icons.set("eye-slash","bi-eye-slash"),this.icons.set("lock","bi-lock"),this.icons.set("unlock","bi-unlock"),this.icons.set("user","bi-person"),this.icons.set("team","bi-people"),this.icons.set("crown","bi-crown"),this.icons.set("shield","bi-shield-check")}get(t,e="bi-question-circle"){return this.icons.get(t)||e}create(t,e="",a={}){const s=this.get(t),i=document.createElement("i");return i.className=`${s} ${e}`.trim(),Object.entries(a).forEach(([n,o])=>{i.setAttribute(n,o)}),i}createSVG(t,e=16,a=""){const s=document.createElementNS("http://www.w3.org/2000/svg","svg");return s.setAttribute("width",e),s.setAttribute("height",e),s.setAttribute("class",a),s.setAttribute("aria-hidden","true"),s}}class D{constructor(){this.icons=new Map,this.size=20,this.strokeWidth=2,this.loadLucideIcons()}async loadLucideIcons(){try{const t=await Lt(()=>import("./lucide-CPfDPjHG.js"),[]).catch(()=>null);if(!t){console.info("Lucide icons not installed, using Bootstrap Icons only");return}const{BarChart3:e,Users:a,Settings:s,Bell:i,Search:n,Menu:o,X:c,Check:l,AlertTriangle:u,Info:d,CheckCircle:h,XCircle:p,ArrowUp:y,ArrowDown:A,Plus:C,Edit:I,Trash2:L,Download:k,Upload:T,Home:M,Calendar:x,Clock:N,Mail:B,Phone:$,MapPin:R,Heart:_,Star:O,Bookmark:F,Share:q,Copy:U,ExternalLink:H,RefreshCw:W,Filter:j,ArrowUpDown:V,Grid3X3:G,List:z,Image:J,FileText:K,Folder:Y,Eye:Q,EyeOff:X,Lock:Z,Unlock:tt,User:et,Crown:at,Shield:st}=t;this.icons.set("dashboard",e),this.icons.set("users",a),this.icons.set("settings",s),this.icons.set("notifications",i),this.icons.set("search",n),this.icons.set("menu",o),this.icons.set("close",c),this.icons.set("check",l),this.icons.set("warning",u),this.icons.set("info",d),this.icons.set("success",h),this.icons.set("error",p),this.icons.set("arrow-up",y),this.icons.set("arrow-down",A),this.icons.set("plus",C),this.icons.set("edit",I),this.icons.set("delete",L),this.icons.set("download",k),this.icons.set("upload",T),this.icons.set("home",M),this.icons.set("calendar",x),this.icons.set("clock",N),this.icons.set("mail",B),this.icons.set("phone",$),this.icons.set("location",R),this.icons.set("heart",_),this.icons.set("star",O),this.icons.set("bookmark",F),this.icons.set("share",q),this.icons.set("copy",U),this.icons.set("external",H),this.icons.set("refresh",W),this.icons.set("filter",j),this.icons.set("sort",V),this.icons.set("grid",G),this.icons.set("list",z),this.icons.set("image",J),this.icons.set("file",K),this.icons.set("folder",Y),this.icons.set("eye",Q),this.icons.set("eye-slash",X),this.icons.set("lock",Z),this.icons.set("unlock",tt),this.icons.set("user",et),this.icons.set("crown",at),this.icons.set("shield",st),console.info("âœ¨ Lucide icons loaded successfully")}catch{console.info("Lucide icons not available, falling back to Bootstrap Icons only")}}create(t,e={}){if(!this.icons.get(t))return console.warn(`Icon "${t}" not found in Lucide icons`),null;const{size:s=this.size,strokeWidth:i=this.strokeWidth,className:n="",color:o="currentColor"}=e,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",s),c.setAttribute("height",s),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.setAttribute("stroke",o),c.setAttribute("stroke-width",i),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("class",`lucide lucide-${t} ${n}`.trim()),c.setAttribute("aria-hidden","true");const l=document.createElementNS("http://www.w3.org/2000/svg","path");return c.appendChild(l),c}}class kt{constructor(t="bootstrap"){this.provider=t,this.manager=t==="lucide"?new D:new S}get(t){return this.manager.get?this.manager.get(t):t}create(t,e={}){if(this.provider==="lucide")return this.manager.create(t,e);{const{className:a="",...s}=e;return this.manager.create(t,a,s)}}replaceIcon(t,e,a={}){if(this.provider==="bootstrap"){const s=this.get(e);t.className=t.className.replace(/bi-[\w-]+/g,""),t.classList.add(s)}else{const s=this.create(e,a);s&&t.parentNode&&t.parentNode.replaceChild(s,t)}}preloadIcons(t=[]){t.forEach(e=>{this.create(e)})}switchProvider(t){this.provider=t,this.manager=t==="lucide"?new D:new S}}const b=new kt("bootstrap");function Tt(){g.data("settingsComponent",()=>({sidebarVisible:!1,activeSection:"general",confirmReset:!1,settings:{language:"en",timezone:"America/New_York",dateFormat:"MM/DD/YYYY",currencyCode:"USD",cardVisibility:{totalAssetsValue:!0,itemsCount:!0,avgPrice:!0,pendingWarranties:!0,taxDeductible:!0,expiredWarranties:!0},notifications:{desktop:!0,email:!0,sound:!1,marketing:!1},retailers:[]},sections:[{id:"general",name:"General",icon:"bi-gear"},{id:"dashboard",name:"Dashboard",icon:"bi-speedometer2"},{id:"notifications",name:"Notifications",icon:"bi-bell"},{id:"retailer",name:"Retailer",icon:"bi-shop"},{id:"data-management",name:"Data Management",icon:"bi-database"}],newRetailerName:"",retailerList:[],importFile:null,exportFormats:["JSON","CSV"],async init(){document.documentElement.getAttribute("data-bs-theme")||localStorage.getItem("theme"),this.restoreActiveSection(),this.loadSettings(),await this.loadRetailers(),setTimeout(()=>{this.hideLoadingScreen()},300)},restoreActiveSection(){const r=window.location.hash.replace("#",""),t=["general","dashboard","notifications","retailer","dataManagement"];r&&t.includes(r)&&(this.activeSection=r),window.addEventListener("hashchange",()=>{const e=window.location.hash.replace("#","");e&&t.includes(e)&&(this.activeSection=e)})},hideLoadingScreen(){const r=document.getElementById("loading-screen");r&&(r.style.opacity="0",r.style.transition="opacity 0.5s ease-out",setTimeout(()=>{r.style.display="none"},500))},loadSettings(){const r=localStorage.getItem("appSettings");if(r)try{const t=JSON.parse(r);this.settings={...this.settings,...t}}catch(t){console.warn("Failed to load saved settings:",t)}},saveSettings(){try{localStorage.setItem("appSettings",JSON.stringify(this.settings)),this.showNotification("Settings saved successfully!","success")}catch(r){this.showNotification("Failed to save settings","error"),console.error("Failed to save settings:",r)}},setActiveSection(r){this.activeSection=r,this.sidebarVisible=!1,window.history.replaceState(null,null,`#${r}`)},async loadRetailers(){try{const r=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",[t,e]=await Promise.all([fetch(`${r}/retailers`),fetch(`${r}/brands?limit=100`)]);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json(),s=e.ok?await e.json():{items:[]},i=new Set(s.items.map(o=>o.name)),n=new Map(s.items.map(o=>[o.name,o.id]));this.retailerList=a.items.map(o=>({id:o.id,name:o.name,isBrand:i.has(o.name),brandId:n.get(o.name)||null})),this.settings.retailers=this.retailerList}catch(r){console.error("Error loading retailers:",r),this.retailerList=[],this.settings.retailers=[]}},async addRetailer(){if(this.newRetailerName.trim())try{const r=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",t=await fetch(`${r}/retailers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.newRetailerName,url:""})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();this.retailerList.push({id:e.id,name:e.name,isBrand:!1}),this.settings.retailers=this.retailerList,this.newRetailerName="",this.showNotification("Retailer added successfully!","success")}catch(r){console.error("Error adding retailer:",r),this.showNotification("Failed to add retailer","error")}},async removeRetailer(r){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=this.retailerList.find(s=>s.id===r),a=await fetch(`${t}/retailers/${r}`,{method:"DELETE"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);if(e&&e.isBrand&&e.brandId)try{await fetch(`${t}/brands/${e.brandId}`,{method:"DELETE"})}catch(s){console.warn("Failed to delete associated brand:",s)}this.retailerList=this.retailerList.filter(s=>s.id!==r),this.settings.retailers=this.retailerList,this.showNotification("Retailer removed successfully!","success")}catch(t){console.error("Error removing retailer:",t),this.showNotification("Failed to remove retailer","error")}},deleteRetailer(r){return this.removeRetailer(r)},async toggleRetailerBrand(r){const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=!r.isBrand;try{if(e){const a=await fetch(`${t}/brands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.name,url:""})});if(a.ok){const s=await a.json();r.isBrand=!0,r.brandId=s.id,this.settings.retailers=this.retailerList,this.showNotification(`"${r.name}" added to Brands`,"success")}else if(a.status===409)r.isBrand=!0,this.settings.retailers=this.retailerList,this.showNotification(`"${r.name}" is already in Brands`,"info");else throw new Error(`HTTP error! status: ${a.status}`)}else{const a=await fetch(`${t}/brands?limit=100`);if(a.ok){const i=(await a.json()).items.find(n=>n.name===r.name);if(i){const n=await fetch(`${t}/brands/${i.id}`,{method:"DELETE"});if(n.ok)r.isBrand=!1,delete r.brandId,this.settings.retailers=this.retailerList,this.showNotification(`"${r.name}" removed from Brands`,"success");else throw new Error(`Failed to delete brand: ${n.status}`)}else r.isBrand=!1,delete r.brandId,this.settings.retailers=this.retailerList}}}catch(a){console.error("Error toggling brand status:",a),this.showNotification("Failed to update brand status","error"),r.isBrand=!e,this.settings.retailers=this.retailerList}},exportData(r){const t={settings:this.settings,exportDate:new Date().toISOString(),format:r};let e,a,s;r==="JSON"?(e=JSON.stringify(t,null,2),a=`data_export_${new Date().getTime()}.json`,s="application/json"):r==="CSV"&&(e=this.convertToCSV(t),a=`data_export_${new Date().getTime()}.csv`,s="text/csv");const i=new Blob([e],{type:s}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=a,n.click(),URL.revokeObjectURL(n.href),this.showNotification(`Data exported as ${r}!`,"success")},convertToCSV(r){let t=`Key,Value
`;const e=r.settings,a=(s,i="")=>{for(const n in s)if(s.hasOwnProperty(n)){const o=s[n],c=i?`${i}.${n}`:n;if(typeof o=="object"&&o!==null&&!Array.isArray(o))a(o,c);else{const l=Array.isArray(o)?JSON.stringify(o):o;t+=`"${c}","${l}"
`}}};return a(e),t},handleFileImport(r){const t=r.target.files[0];if(!t)return;const e=new FileReader;e.onload=a=>{try{const s=a.target.result;let i;t.name.endsWith(".json")?(i=JSON.parse(s),i.settings&&(this.settings={...this.settings,...i.settings},this.saveSettings(),this.showNotification("Data imported successfully from JSON!","success"))):t.name.endsWith(".csv")&&this.showNotification("CSV import received. Manual parsing required.","info")}catch(s){this.showNotification("Failed to import file","error"),console.error("Import error:",s)}},e.readAsText(t)},resetAllData(){this.confirmReset=!0},confirmResetData(){localStorage.removeItem("appSettings"),this.settings={language:"en",timezone:"America/New_York",dateFormat:"MM/DD/YYYY",currencyCode:"USD",cardVisibility:{totalAssetsValue:!0,itemsCount:!0,avgPrice:!0,pendingWarranties:!0,taxDeductible:!0,expiredWarranties:!0},notifications:{desktop:!0,email:!0,sound:!1,marketing:!1},retailers:[]},this.retailerList=[],this.confirmReset=!1,this.showNotification("All data has been reset to defaults","success")},showNotification(r,t){console.log(`[${t.toUpperCase()}] ${r}`)}}))}function Mt(){g.data("inventoryTable",()=>({items:[],filteredItems:[],selectedItems:[],paginatedItems:[],currentPage:1,itemsPerPage:10,totalPages:1,searchQuery:"",statusFilter:"",dateFilter:"",sortField:"id",sortDirection:"asc",stats:{total:0,ordered:0,received:0,totalSpending:0},async init(){await this.loadInventoryData(),this.filterInventory(),this.calculateStats(),this.updatePagination();const r=document.getElementById("inventoryModal");r&&r.addEventListener("show.bs.modal",t=>{setTimeout(()=>{const e=r.querySelector(".modal-content");if(e&&e.__x){const a=e.__x.$data;t.relatedTarget&&t.relatedTarget.classList.contains("btn-primary")&&t.relatedTarget.textContent.includes("New Purchase")&&a.resetForm(),console.log("Modal opened - isEditMode:",a.isEditMode)}},10)}),window.addEventListener("refresh-inventory",async()=>{console.log("Received refresh-inventory event"),await this.loadInventoryData(),this.filterInventory(),this.calculateStats(),this.updatePagination(),console.log("Inventory data refreshed after purchase update")}),setTimeout(()=>{this.hideLoadingScreen()},500)},hideLoadingScreen(){const r=document.getElementById("loading-screen");r&&(r.style.opacity="0",r.style.transition="opacity 0.5s ease-out",setTimeout(()=>{r.style.display="none"},500))},async loadInventoryData(){try{this.showLoadingState();const r=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",t=await fetch(`${r}/purchases/`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();this.items=e.items.map(a=>{const s=a.purchase_date,i=a.warranty?.warranty_end||a.warranty_expiry,n=a.return_deadline,o=c=>{if(!c)return"";const[l,u,d]=c.split("-").map(Number);return new Date(l,u-1,d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return{id:a.id,name:a.product_name,brand:a.brand?.name||"Unknown",retailer:a.retailer?.name||"Unknown",price:parseFloat(a.price),status:a.status?.toLowerCase()||"ordered",purchaseDate:o(s),purchaseDateISO:s,warrantyExpiry:i||"",notes:a.notes||"",taxDeductible:a.tax_deductible===1||a.tax_deductible===!0,modelNumber:a.model_number||"",serialNumber:a.serial_number||"",quantity:a.quantity||1,link:a.link||"",returnDeadline:n||"",returnPolicy:a.return_policy||"",tags:a.tags||""}}),this.hideLoadingState()}catch(r){console.error("Error loading inventory data:",r),this.hideLoadingState(),this.showErrorState(),this.loadMockInventoryData()}},loadMockInventoryData(){const r=[{name:"Apple iPhone 15 Pro",brand:"Apple",price:999},{name:"Samsung Galaxy S24",brand:"Samsung",price:899},{name:'MacBook Pro 16"',brand:"Apple",price:2499},{name:"Sony WH-1000XM5 Headphones",brand:"Sony",price:399},{name:"iPad Air",brand:"Apple",price:599},{name:"Dell XPS 13",brand:"Dell",price:1299},{name:'LG 27" Gaming Monitor',brand:"LG",price:499},{name:"Apple Watch Series 9",brand:"Apple",price:399},{name:"Sony PlayStation 5",brand:"Sony",price:499},{name:"IKEA Billy Bookshelf",brand:"IKEA",price:79.99},{name:"Bose Smart Speaker",brand:"Bose",price:199},{name:'Samsung 55" QLED TV',brand:"Samsung",price:1299},{name:"AirPods Pro Max",brand:"Apple",price:549},{name:"Mechanical Keyboard",brand:"Corsair",price:149},{name:"Wireless Mouse",brand:"Logitech",price:59.99},{name:'LG OLED TV 65"',brand:"LG",price:1999},{name:"Google Pixel 8 Pro",brand:"Google",price:999},{name:"Nintendo Switch OLED",brand:"Nintendo",price:349},{name:"Canon EOS R5",brand:"Canon",price:3899},{name:"DJI Mini 3 Pro",brand:"DJI",price:369}],t=()=>{const e=new Date(2024,6,1).getTime(),a=new Date(2025,0,31).getTime(),s=e+Math.random()*(a-e);return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};this.items=Array.from({length:20},(e,a)=>{const s=r[a%r.length],i=s.price+(Math.random()*200-100);return{id:a+1,name:s.name,brand:s.brand,price:parseFloat(i.toFixed(2)),status:Math.random()>.35?"received":"ordered",purchaseDate:t()}})},showLoadingState(){const r=document.querySelector(".table-responsive");if(r){this.hideLoadingState();const t=document.createElement("div");t.className="position-absolute top-50 start-50 translate-middle inventory-loader",t.innerHTML='<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',t.style.zIndex="10",t.style.backgroundColor="rgba(255, 255, 255, 0.7)",t.style.padding="20px",t.style.borderRadius="5px",r.style.position="relative",r.appendChild(t)}},hideLoadingState(){const r=document.querySelector(".table-responsive");if(r){const t=r.querySelector(".inventory-loader");t&&t.remove()}},showErrorState(){const r=document.querySelector(".table-responsive");if(r){const t=document.createElement("div");t.className="alert alert-danger",t.innerHTML="<strong>Error:</strong> Failed to load inventory data. Please check your connection and try again.",r.parentNode.insertBefore(t,r)}},calculateStats(){this.stats.total=this.items.length,this.stats.ordered=this.items.filter(r=>r.status==="ordered").length,this.stats.received=this.items.filter(r=>r.status==="received").length,this.stats.totalSpending=this.items.reduce((r,t)=>r+t.price,0)},filterInventory(){this.filteredItems=this.items.filter(r=>{const t=!this.searchQuery||r.name.toLowerCase().includes(this.searchQuery.toLowerCase())||r.brand.toLowerCase().includes(this.searchQuery.toLowerCase()),e=!this.statusFilter||r.status===this.statusFilter;return t&&e}),this.sortItems(),this.currentPage=1,this.updatePagination()},sortItems(){this.filteredItems.sort((r,t)=>{let e=r[this.sortField],a=t[this.sortField];if(typeof e=="number"&&typeof a=="number")return this.sortDirection==="asc"?e-a:a-e;const s=String(e).localeCompare(String(a));return this.sortDirection==="asc"?s:-s})},sortBy(r){this.sortField===r?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=r,this.sortDirection="asc"),this.filterInventory()},updatePagination(){this.totalPages=Math.ceil(this.filteredItems.length/this.itemsPerPage);const r=(this.currentPage-1)*this.itemsPerPage,t=r+this.itemsPerPage;this.paginatedItems=this.filteredItems.slice(r,t)},get visiblePages(){const r=[],e=Math.floor(2.5);let a=Math.max(1,this.currentPage-e),s=Math.min(this.totalPages,a+5-1);s-a<4&&(a=Math.max(1,s-5+1)),a>1&&(r.push(1),a>2&&r.push("..."));for(let i=a;i<=s;i++)r.push(i);return s<this.totalPages&&(s<this.totalPages-1&&r.push("..."),r.push(this.totalPages)),r},goToPage(r){r>0&&r<=this.totalPages&&(this.currentPage=r,this.updatePagination())},toggleAll(r){r?this.selectedItems=this.paginatedItems.map(t=>t.id):this.selectedItems=[]},viewItem(r){console.log("View item:",r);const t={productName:r.name,retailer:r.retailer||"Amazon",brand:r.brand,modelNumber:r.modelNumber||"",serialNumber:r.serialNumber||"",purchaseDate:r.purchaseDate,price:r.price,quantity:r.quantity||1,link:r.link||"",warrantyExpiry:r.warrantyExpiry||"",returnDeadline:r.returnDeadline||"",returnPolicy:r.returnPolicy||"",taxDeductible:r.taxDeductible||!1,tags:r.tags||"",notes:r.notes||""},e=document.querySelector('[x-data="viewPurchaseDetails()"]');e&&e.__x&&e.__x.$data.setItem(t),new w(document.getElementById("viewDetailsModal")).show()},editItem(r){const t=this.items.find(i=>i.id===r.id)||r;console.log("Edit item - fresh item:",t),console.log("Edit item - modelNumber:",t.modelNumber),console.log("Edit item - serialNumber:",t.serialNumber);const e={productName:t.name,retailer:t.retailer||"",brand:t.brand||"",modelNumber:t.modelNumber||"",serialNumber:t.serialNumber||"",purchaseDate:t.purchaseDateISO||t.purchaseDate,price:t.price,quantity:t.quantity||1,link:t.link||"",warrantyExpiry:t.warrantyExpiry||"",returnDeadline:t.returnDeadline||"",returnPolicy:t.returnPolicy||"",taxDeductible:t.taxDeductible||!1,tags:t.tags||"",notes:t.notes||"",id:t.id};window.dispatchEvent(new CustomEvent("edit-purchase",{detail:{item:e}}));const a=document.getElementById("inventoryModal");new w(a).show()},deleteItem(r){confirm(`Delete "${r.name}"?`)&&(this.items=this.items.filter(t=>t.id!==r.id),this.selectedItems=this.selectedItems.filter(t=>t!==r.id),this.filterInventory(),this.calculateStats(),console.log("Item deleted:",r))}}))}class xt{constructor(){this.components=new Map,this.isInitialized=!1}async init(){if(!this.isInitialized)try{document.readyState==="loading"&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t)}),this.themeManager=new St,this.notificationManager=new Et,this.sidebarManager=new At,this.iconManager=b,this.iconManager.preloadIcons(["dashboard","purchases","analytics","settings","notifications","search","menu","check","warning","info","success","error"]),this.initBootstrapComponents(),await this.initPageComponents(),this.setupEventListeners(),this.initNavigation(),this.initTooltipsAndPopovers(),this.initAlpine(),this.isInitialized=!0,window.scrollTo(0,0),console.log("ðŸš€ Admin App initialized successfully"),this.hideLoadingScreen()}catch(t){console.error("âŒ Failed to initialize Admin App:",t)}}initBootstrapComponents(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(t=>{new rt(t)}),document.querySelectorAll(".modal").forEach(t=>{new w(t)}),document.querySelectorAll(".offcanvas").forEach(t=>{new it(t)}),document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(t=>{new nt(t)}),document.querySelectorAll('[data-bs-toggle="tab"]').forEach(t=>{new ot(t)}),document.querySelectorAll(".toast").forEach(t=>{new E(t)})}initTooltipsAndPopovers(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(t=>{new ct(t)}),document.querySelectorAll('[data-bs-toggle="popover"]').forEach(t=>{new lt(t)})}async initPageComponents(){switch(document.body.dataset.page){case"dashboard":const e=new Dt;this.components.set("dashboard",e),window.dashboardManager=e;break;case"settings":console.log("âš™ï¸ Settings page components registered");break;case"inventory":console.log("ðŸ“¦ Inventory page components registered");break;default:console.log("Page-specific components loading complete")}}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches("[data-theme-toggle]")&&this.themeManager.toggleTheme()}),document.addEventListener("click",t=>{t.target.closest("[data-fullscreen-toggle]")&&(t.preventDefault(),this.toggleFullscreen())}),document.addEventListener("keydown",t=>{this.handleKeyboardShortcuts(t)})}handleKeyboardShortcuts(t){if((t.ctrlKey||t.metaKey)&&t.key==="k"){t.preventDefault();const e=document.querySelector("[data-search-input]");e&&e.focus()}}hideLoadingScreen(){const t=document.getElementById("loading-screen");t&&(t.style.opacity="0",t.style.transition="opacity 0.5s ease-out",setTimeout(()=>{t.style.display="none"},500))}async toggleFullscreen(){try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(t){console.error("Fullscreen toggle failed:",t)}}getComponent(t){return this.components.get(t)}initNavigation(){document.addEventListener("click",e=>{const a=e.target.closest('[data-bs-toggle="collapse"]');if(a){const s=a.getAttribute("data-bs-target"),i=a.getAttribute("aria-expanded")==="true";localStorage.setItem(`submenu-${s}`,(!i).toString())}}),document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(e=>{const a=e.getAttribute("data-bs-target");if(localStorage.getItem(`submenu-${a}`)==="true"){const i=document.querySelector(a);i&&(i.classList.add("show"),e.setAttribute("aria-expanded","true"))}})}initAlpine(){g.data("searchComponent",()=>({query:"",results:[],isLoading:!1,async search(){if(this.query.length<2){this.results=[];return}this.isLoading=!0,await new Promise(t=>setTimeout(t,300)),this.results=[{title:"Dashboard",url:"index.html",type:"page"},{title:"Inventory",url:"inventory.html",type:"page"},{title:"Settings",url:"settings.html",type:"page"}].filter(t=>t.title.toLowerCase().includes(this.query.toLowerCase())),this.isLoading=!1}})),g.data("statsCounter",(t=0,e=1)=>({value:t,init(){setInterval(()=>{this.value+=Math.floor(Math.random()*e)+1},5e3)}})),g.data("themeSwitch",()=>({currentTheme:"light",init(){this.currentTheme=localStorage.getItem("theme")||"light"},toggle(){this.currentTheme=this.currentTheme==="light"?"dark":"light",document.documentElement.setAttribute("data-bs-theme",this.currentTheme),localStorage.setItem("theme",this.currentTheme)}})),g.data("iconDemo",()=>({currentProvider:"bootstrap",switchProvider(t){this.currentProvider=t,b.switchProvider(t),console.log(`ðŸŽ¨ Switched to ${t} icons`)},getIcon(t){return b.get(t)}})),g.data("quickAddForm",()=>({itemType:"task",title:"",description:"",priority:"medium",dateTime:"",assignee:"",init(){const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),this.dateTime=t.toISOString().slice(0,16)},resetForm(){this.itemType="task",this.title="",this.description="",this.priority="medium",this.assignee="";const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),this.dateTime=t.toISOString().slice(0,16)},saveItem(){if(!this.title.trim()){window.AdminApp.notificationManager.warning("Please enter a title");return}const t={type:this.itemType,title:this.title,description:this.description,priority:this.itemType==="task"?this.priority:null,dateTime:["event","reminder"].includes(this.itemType)?this.dateTime:null,assignee:this.itemType==="task"?this.assignee:null,createdAt:new Date().toISOString()};console.log("New item created:",t);const e={task:"Task",note:"Note",event:"Event",reminder:"Reminder"};window.AdminApp.notificationManager.success(`${e[this.itemType]} "${this.title}" created successfully!`),this.resetForm()}})),g.data("addPurchaseForm",()=>({form:{productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},isEditMode:!1,editingItemId:null,retailers:[],brands:[],async init(){this.resetForm(),await this.loadRetailers(),await this.loadBrands(),window.addEventListener("edit-purchase",t=>{console.log("Received edit-purchase event:",t.detail),t.detail&&t.detail.item&&this.enterEditMode(t.detail.item)}),this.$watch("form.purchaseDate",t=>{t&&this.validateDatesAfterPurchaseDateChange()})},enterEditMode(t){this.isEditMode=!0,this.editingItemId=t.id,this.form.productName=t.productName||"",this.form.retailer=t.retailer||"",this.form.brand=t.brand||"",this.form.modelNumber=t.modelNumber||"",this.form.serialNumber=t.serialNumber||"",this.form.purchaseDate=t.purchaseDate||"",this.form.price=t.price||"",this.form.quantity=t.quantity||1,this.form.link=t.link||"",this.form.warrantyExpiry=t.warrantyExpiry||"",this.form.returnDeadline=t.returnDeadline||"",this.form.returnPolicy=t.returnPolicy||"",this.form.taxDeductible=this.ensureBoolean(t.taxDeductible),this.form.tags=t.tags||"",this.form.notes=t.notes||"",console.log("Entered edit mode with item:",t),console.log("Form retailer set to:",this.form.retailer),console.log("Form brand set to:",this.form.brand)},get isBrandRetailer(){if(!this.form.retailer)return!1;const t=this.retailers.find(e=>e.name===this.form.retailer);return console.log("Checking isBrandRetailer:",this.form.retailer,"found:",t,"is_brand:",t?.is_brand),t&&t.is_brand},onRetailerChange(){this.isBrandRetailer?this.form.brand=this.form.retailer:this.isEditMode||(this.form.brand="")},validateDatesAfterPurchaseDateChange(){this.form.warrantyExpiry&&this.form.warrantyExpiry<this.form.purchaseDate&&(this.form.warrantyExpiry="",window.AdminApp.notificationManager.warning("Warranty expiry date was cleared because it was before the new purchase date")),this.form.returnDeadline&&this.form.returnDeadline<this.form.purchaseDate&&(this.form.returnDeadline="",window.AdminApp.notificationManager.warning("Return deadline was cleared because it was before the new purchase date"))},ensureBoolean(t){return typeof t=="boolean"?t:typeof t=="number"?t!==0:typeof t=="string"?t.toLowerCase()==="true"||t==="1":!!t},async loadRetailers(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/retailers/`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();this.retailers=a.items||[]}catch(t){console.error("Error loading retailers:",t),this.retailers=[]}},async loadBrands(){try{const t=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",e=await fetch(`${t}/brands/`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();this.brands=a.items||[]}catch(t){console.error("Error loading brands:",t),this.brands=[]}},resetForm(){this.form={productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},this.isEditMode=!1,this.editingItemId=null},savePurchase(){if(!this.form.productName.trim()){window.AdminApp.notificationManager.warning("Please enter a product name");return}if(!this.form.retailer.trim()){window.AdminApp.notificationManager.warning("Please select a retailer");return}if(!this.form.brand.trim()){window.AdminApp.notificationManager.warning("Please enter a brand");return}if(!this.form.purchaseDate){window.AdminApp.notificationManager.warning("Please enter a purchase date");return}if(!this.form.price){window.AdminApp.notificationManager.warning("Please enter a price");return}if(this.form.warrantyExpiry&&this.form.warrantyExpiry<this.form.purchaseDate){window.AdminApp.notificationManager.warning("Warranty expiry date cannot be before purchase date");return}if(this.form.returnDeadline&&this.form.returnDeadline<this.form.purchaseDate){window.AdminApp.notificationManager.warning("Return deadline cannot be before purchase date");return}const t={productName:this.form.productName,retailer:this.form.retailer,brand:this.form.brand,modelNumber:this.form.modelNumber,serialNumber:this.form.serialNumber,purchaseDate:this.form.purchaseDate,price:parseFloat(this.form.price),quantity:parseInt(this.form.quantity)||1,link:this.form.link,warrantyExpiry:this.form.warrantyExpiry||null,returnDeadline:this.form.returnDeadline||null,returnPolicy:this.form.returnPolicy,taxDeductible:this.form.taxDeductible,tags:this.form.tags,notes:this.form.notes,createdAt:new Date().toISOString()};console.log("New purchase created:",t),this.submitPurchaseToAPI(t)},async getOrCreateRetailer(t,e){let a=this.retailers.find(n=>n.name.toLowerCase()===e.toLowerCase());if(a)return a.id;const s=await fetch(`${t}/retailers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,url:""})});if(!s.ok)throw new Error("Failed to create retailer");const i=await s.json();return this.retailers.push(i),i.id},async getOrCreateBrand(t,e){let a=this.brands.find(n=>n.name.toLowerCase()===e.toLowerCase());if(a)return a.id;const s=await fetch(`${t}/brands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,url:""})});if(!s.ok)throw new Error("Failed to create brand");const i=await s.json();return this.brands.push(i),i.id},async submitPurchaseToAPI(t){try{const e=window.APP_CONFIG?.API_URL||"http://192.168.68.55:8000/api",a=await this.getOrCreateRetailer(e,t.retailer),s=await this.getOrCreateBrand(e,t.brand),i={product_name:t.productName,price:t.price,purchase_date:t.purchaseDate,retailer_id:a,brand_id:s,status:"RECEIVED",notes:t.notes,tax_deductible:this.ensureBoolean(t.taxDeductible)?1:0,warranty_expiry:t.warrantyExpiry||null,model_number:t.modelNumber||null,serial_number:t.serialNumber||null,quantity:parseInt(t.quantity)||1,link:t.link||null,return_deadline:t.returnDeadline||null,return_policy:t.returnPolicy||null,tags:t.tags||null},n=this.isEditMode&&this.editingItemId,o=n?`${e}/purchases/${this.editingItemId}`:`${e}/purchases`,l=await fetch(o,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!l.ok){const p=await l.json().catch(()=>({}));throw new Error(p.detail||`HTTP error! status: ${l.status}`)}const u=await l.json();console.log("Purchase saved to API:",u);const d=n?`Purchase "${this.form.productName}" updated successfully!`:`Purchase "${this.form.productName}" created successfully!`,h=document.getElementById("newItemModal");if(h){const p=w.getInstance(h);p&&p.hide()}this.resetForm(),window.AdminApp.notificationManager.success(d),setTimeout(async()=>{console.log("Refreshing data after purchase...");const p=document.querySelector('[data-page="dashboard"]');console.log("Is dashboard:",!!p,"dashboardManager:",!!window.dashboardManager),window.dashboardManager&&p&&(console.log("Refreshing dashboard data..."),await window.dashboardManager.loadDashboardData(),console.log("Dashboard data refreshed")),window.location.pathname.includes("inventory")&&(console.log("Refreshing inventory data..."),window.dispatchEvent(new CustomEvent("refresh-inventory")))},1e3)}catch(e){console.error("Error saving purchase:",e),window.AdminApp.notificationManager.error(`Failed to save purchase: ${e.message}`)}}})),g.data("viewPurchaseDetails",()=>({item:{productName:"",retailer:"",brand:"",modelNumber:"",serialNumber:"",purchaseDate:"",price:"",quantity:1,link:"",warrantyExpiry:"",returnDeadline:"",returnPolicy:"",taxDeductible:!1,tags:"",notes:""},init(){},setItem(t){this.item={...t}},editItem(){console.log("Edit item:",this.item)}})),Tt(),Mt(),g.start(),window.Alpine=g}showDemoNotifications(){setTimeout(()=>{this.notificationManager.info("New purchase added",{action:{text:"View",handler:'window.location.href="/purchases"'}})},3e3),setTimeout(()=>{this.notificationManager.warning("Server maintenance in 10 minutes")},6e3),setTimeout(()=>{this.notificationManager.success("Backup completed successfully")},9e3)}destroy(){this.components.forEach(t=>{t.destroy&&t.destroy()}),this.components.clear(),this.isInitialized=!1}}const P=new xt;P.init();window.AdminApp=P;window.IconManager=b;
